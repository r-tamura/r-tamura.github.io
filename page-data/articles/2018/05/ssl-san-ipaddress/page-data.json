{"componentChunkName":"component---src-templates-blog-article-js","path":"/articles/2018/05/ssl-san-ipaddress/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://rtam.xyz","title":"Rの技術メモ","authorName":"r-tamura","authorDetail":"Web関連多めのソフトウェアエンジニアです。","githubId":"r-tamura","twitterId":"r_tamura30"}},"markdownRemark":{"html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.14723926380368%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAChklEQVQozx3D227aBgCAYd/vYpqUraqUrQlZUg5JgCQYm2BszrYxYGwgHIzB4ABNwshYW7JM6sV6s5u+wl71n7RP+oTNxOBl5fAptJm7GpVsguvoEVfRCOnoMXIyhnp1jlfP86FboaUkqUuX+H2NYGbwvGjyaWbzMKr/X9ivu/yx6LDsV/gYdChl4pxHDhHjEX49fIN7m+ZBz7GsyDx7bVztBjkeoWuIBF6ZQJfx8klWvTJuKYXw5DdZD2vMTJm5JlLPXnD09oCff/yBn77/jnryjE1DZVXP05ES2NkohfMT2qUM990ijdg75k2Fz6seW99CmDh5HocV5raCmThmrFxx/PaAROQduiLhqFmeWkV+75l4pspmYNHOXaBenuBKCRzxPX893vH3bsqX3zyEZdAiGJZYDus4SpKhHCeXiJCNnfHn84bt3OOf3T1ft/d8e93y77ev7Pw2/fwF1vUpUz3DPrTZ+SZb30CYOiqzXonQs5h2ilipI2w5QfzwALsgErbKbNwqfinLy8zlddHlwS0yrWYwL4+YNSRCR2FiiMwdFeHBM9hMGmynFh9XfcY1mdDM01IzNG6iTOsyoS4zLqS4txRe5jZPdzUCM8/cyPE0Mlj2KozMHP2aiPDoGXxed9mv++w3I1Yjk0DPEtplbFVk1S6yahUI9Fv8isTrzGYftPGrIgvrlnFTpafnMAtpbC2FEA6KDGyFxbDKbFCiZ2ZpS2csmyqP4w67YYOgJjFQrpnrBdaWRl9KYF78wsSQqEoJlHSEiniKW75GCEZlRn0Nv1fCaWQp52I4Wppp+YZJIc2ddM5ESdOT4rTTZ1jpUwonb7ClOF82Afv1hKaWQs/FmFgy/wH/dXbjoJujpQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1.1.1.1_web\"\n        title=\"1.1.1.1_web\"\n        src=\"/static/c0f6796e1f605dccbcc075c30c02a16b/a6d36/1.1.1.1_web.png\"\n        srcset=\"/static/c0f6796e1f605dccbcc075c30c02a16b/222b7/1.1.1.1_web.png 163w,\n/static/c0f6796e1f605dccbcc075c30c02a16b/ff46a/1.1.1.1_web.png 325w,\n/static/c0f6796e1f605dccbcc075c30c02a16b/a6d36/1.1.1.1_web.png 650w,\n/static/c0f6796e1f605dccbcc075c30c02a16b/e548f/1.1.1.1_web.png 975w,\n/static/c0f6796e1f605dccbcc075c30c02a16b/1be7e/1.1.1.1_web.png 1059w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>2018/4/1からCDNのCloudflareがIPアドレス<code class=\"language-text\">1.1.1.1</code>をDNSサーバとして運用を開始した。\n<code class=\"language-text\">1.1.1.1</code>ではWebサーバも公開されており、アクセスしてみた際にドメインではなくで <a href=\"https://1.1.1.1\" target=\"_blank\" rel=\"nofollow\">https://1.1.1.1</a> という<strong>IPアドレスでSSL接続していた</strong>ことに疑問を覚えたので仕組みを調べてみた。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 279px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.496932515337424%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAgElEQVQI133JwQrCMBBF0f7/J4oUapPMZEKSiaTo7ko30oX44MCDu6goJ8uG5YykREqJrJmSDVUlhECM8evs13+13GwlWESrsltkvl/M6dzTg1U2eq/UkinmtFp5DuffFm2GFkVMEFOad8Zwkgmb7Fgxhnd6d9ydMQbHcTDn/OkDlsniZtsPl2gAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"url\"\n        title=\"url\"\n        src=\"/static/8329cec74d5dca11ddfedecae489e414/3af37/url.png\"\n        srcset=\"/static/8329cec74d5dca11ddfedecae489e414/222b7/url.png 163w,\n/static/8329cec74d5dca11ddfedecae489e414/3af37/url.png 279w\"\n        sizes=\"(max-width: 279px) 100vw, 279px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h1>証明書の中身を確認</h1>\n<p>CN, SANで<code class=\"language-text\">1.1.1.1</code>という値が指定されているはずと考えられるので、まずはブラウザから証明書の中身を確認してみる。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.963190184049076%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACAklEQVQoz2VTXY+bMBDk//+ffry2fbunSlUPCOAAxoDBxoZACMmRqXbTVO11pRVgz86Oh3UQxxG07qC1RttqDIPDMAywdoAxFs45FHmB8PUVTdOg73rGO+cxOMd4wnrvkec5gqIoMM8LaqWY1PuRCed5xr7voKBGx+MR6/mMplbotMY4enjneO3+G0f1Qa0qTKPHspyxbRt3Op/P2Pc77vdHSlmhkhK9ceiHE07LFbr36O2EwS9YtzfGVZVCkKQJoihCckhwWS9omwYiy1DkOZNTlGWJLE3w8VuODy8TvobApxeHzy8GX35eESrgft8hhEAQpyniQwKRCVaoW40sSdk37x6EB9oXCUR6YGv2txus6aGk5OdlXVlhmqYIRC4QhiE63XGxNRaVrNDUDebTzGtEnooMlVIoihLbdoU1BrIsIUuJ0Y+MI2sCklkWJRM+/bter1jXld9vtxvqusFRCKhKcbPT6YTL5cL7hKOkmrquEZB3cRhxAR3HGAM3DAx4Rtd1yLIMg7Xs8/ug4zJOdwio47IsmKaJpVNO48TKnkFjI6X8j+D9N48Ndf87iFgpBWstKyNPiYzAFM/ZpFmlv08neuAM1/0hJCB1Im9IMT2f3pB3bdv+g6OJ+Bu3rBsq1TxuyqNLz9n3hq/cc432oyhGnhe8TgLe4+q2R3go8f1HjF9MVYrmzUXKLQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"san.png\"\n        title=\"san.png\"\n        src=\"/static/52e3606eea7346562ba3b5a92b5ec8a2/a6d36/san.png\"\n        srcset=\"/static/52e3606eea7346562ba3b5a92b5ec8a2/222b7/san.png 163w,\n/static/52e3606eea7346562ba3b5a92b5ec8a2/ff46a/san.png 325w,\n/static/52e3606eea7346562ba3b5a92b5ec8a2/a6d36/san.png 650w,\n/static/52e3606eea7346562ba3b5a92b5ec8a2/e548f/san.png 975w,\n/static/52e3606eea7346562ba3b5a92b5ec8a2/35252/san.png 1204w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>SANのところで<code class=\"language-text\">IP Address=1.1.1.1</code>という項目があり、他にも<code class=\"language-text\">1.0.0.1</code>やIPv6形式のアドレスもあることがわかる。\n確かに証明書の中にはIPアドレスで指定されているようだ。そこで、実際に証明書の仕様を確認してみる。</p>\n<h1>RFC仕様</h1>\n<p>[RFC5280][rfc5280]のSANの構造を見てみると以下のようになっている。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  SubjectAltName ::= GeneralNames\n\n  GeneralNames ::= SEQUENCE SIZE (1..MAX) OF GeneralName\n\n  GeneralName ::= CHOICE {  \n    otherName                       [0]     OtherName,  \n    rfc822Name                      [1]     IA5String,  \n    dNSName                         [2]     IA5String,  \n    x400Address                     [3]     ORAddress,  \n    directoryName                   [4]     Name,  \n    ediPartyName                    [5]     EDIPartyName,  \n    uniformResourceIdentifier       [6]     IA5String,  \n    iPAddress                       [7]     OCTET STRING,  \n    registeredID                    [8]     OBJECT IDENTIFIER \n  }  </code></pre></div>\n<p>SANには[7]で<strong>IPアドレス</strong>も指定できることがわかる。他にもいろいろなものが指定できることも確認できる。仕様がわかったので、次はパケットの中身をみてみる。</p>\n<h1>パケットキャプチャをしてみる</h1>\n<p>WiresharkでSSLハンドシェイク時のパケットをキャプチャし、サーバからのレスポンスCertificateのSAN部分のバイナリデータとWireshark上で見える内容を確認してみる。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 609px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 103.06748466257669%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADwklEQVQ4y4WUW2/bRhCF9bf9mD4ERZ2kjR07feoPKOCLjNpBXNhB+1AksWzdKV7FOymJiiXqRjmS+BW7kuOisNsFBrMgMWfPnDm7hdFoxGAwYDgcyuy6LtVqFU3T0DUNyzJpKQqNRp1atUK9ViMIfDzXwXNdLNOk0+mQr5a8fPmCAv9aq9UK3w9oGW1aukXU7eMGMZYbkC1WZF9XTO+WpJM5o+mc23TCOFvI2t29t2tAAZLn+SZWpOMpiulSqjQxvRjd9ik3NHQnIEyGdAdT0mzJbAHTBXKfA6929taAD2C5POlunmHaLp/KDXQnpB10qCgmltfBiRI6txMG0wWTrzC+yyWgWD8+BphLwDlKO+SPG42SFtBw+3xu+ajRCKs/J55COIZglBOMwRsuGeTw/NUTDOfzOZ04xDJ04ijktp/g2DaTUcpq+XWjdv6QV2uGb/efAMyyDM/zqNcbhFGEbTtomk4UxwzTEbNZxkMdLBZrwL29x1rOc+ZZhu95NJtNgiCUe2EjPwjwfZ9hmsou7muXyycA75dgGIahBAnDiDAI0HUdz/MJggDhXRH/CXif7+7uJGAUhqiqShCGBL6Ppmp4vi9NfDsYMBgM/5+hiDQd4rgucRxLzbrdjmSl6wZfvnxhMpmQpin9fp/RePw44D+XMHYcR9iOS5L06CWJ1Gs2m0nmIs+mU3lVp9Ppt9sl1v7+PgXbtjFNC9M0N2GhtFo0FQXDMDBMk3a7jWW1abdtGaLG9TzWtabUV0jx7Nl3FNb2qHN9fU21WqPRaFAul+W3lqpSq9Wo18T/G2mjSqWCbhiybXF4FEXyQOGEH7a3KfR6PSm4pqpour55ZfRvjCVLw5CMVc2Qh7heIGUQtf0kkYNLkj67u7trhtValevSNbVaXTISz5fYqxuGlUqZ0udP2HoTU6ngOxZZNpdtmpaFqrZIk4g3uzsU5EfTXDPTDUzTkAwFK3HdRLYtg7/KGvu/u7wsNnlX6TIZDVE1jU4cUW1q/Fq65fn2awrCwI2NhqVSifLNjdRJaCkeWMFUadT582OFX86b/FwscV5qbwB1fM/l49UNJ1cB37/46V5DVbYpQJRmUw5EaCamJ4F1A11t4bdVHL1B6LWlJx3HkUMRA5ncdtnZeU2hn/RRlKbUShQLdoKporSkhuuJCx2rKKrGTbkiPSoM3u32pDel2Udj3ghjX15eclwsUiwW+e30lJOTE46Pjzk9PePs7IzDw0OOjo44Ojrk+LjIwcEB79+fU7oqyf8XFxd8+PBBktja2uJv17T1pwVe6KEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"captured_san.png\"\n        title=\"captured_san.png\"\n        src=\"/static/acfc1b249fe07c5e6342a95b3413d600/d0d8c/captured_san.png\"\n        srcset=\"/static/acfc1b249fe07c5e6342a95b3413d600/222b7/captured_san.png 163w,\n/static/acfc1b249fe07c5e6342a95b3413d600/ff46a/captured_san.png 325w,\n/static/acfc1b249fe07c5e6342a95b3413d600/d0d8c/captured_san.png 609w\"\n        sizes=\"(max-width: 609px) 100vw, 609px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>バイナリ部分の<code class=\"language-text\">87 04</code>が何を意味しているはわからないが、IPアドレスがオクテット形式でデーター多として見える。</p>\n<h1>まとめ</h1>\n<p>SSL証明書のサブジェクトにIPアドレスが使えることが分かった。今回はRFCを読み、実際にパケットをキャプチャしてみることで仕組みを理解することができた。インターネット上の仕様はいろいろなサイトで解説されているが、全てがRFCを元としているので、わからないことがあったら今後はRFCまで調査するように心がけていきたい。</p>\n<h1>参考</h1>\n<ul>\n<li><a href=\"https://blog.cloudflare.com/announcing-1111/\" target=\"_blank\" rel=\"nofollow\">Announcing 1.1.1.1: the fastest, privacy-first consumer DNS service</a></li>\n</ul>\n<p>[rfc5280][<a href=\"https://tools.ietf.org/html/rfc5280#section-4.2.1.6\" target=\"_blank\" rel=\"nofollow\">https://tools.ietf.org/html/rfc5280#section-4.2.1.6</a>]</p>","frontmatter":{"tags":["ssl","x509","cloudflare","cdn"],"title":"1.1.1.1のSSL","date":"12 May, 2018"},"fields":{"slug":"/articles/2018/05/ssl-san-ipaddress/"}}},"pageContext":{"slug":"/articles/2018/05/ssl-san-ipaddress/"}},"staticQueryHashes":["2340977587"]}