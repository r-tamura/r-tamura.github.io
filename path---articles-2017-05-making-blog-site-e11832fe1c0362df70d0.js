webpackJsonp([0x827db5e44014],{395:function(n,t){n.exports={data:{site:{siteMetadata:{authorName:"r-tamura",authorDetail:"Web関連多めのソフトウェアエンジニアです。",githubId:"r-tamura",twitterId:"r_tamura30"}},markdownRemark:{html:'<p>Gatsbyを使って静的WebサイトをMarkdownで作成し、CircleCI経由でGitHub Pagesにデプロイ。GitHub Pagesはカスタムドメインを設定し、Cloudflare経由でSSLアクセスを可能にする。</p>\n<h1>手順</h1>\n<h2>Gatsbyの導入</h2>\n<h3>インストール</h3>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> -g gatsby\n</code></pre>\n      </div>\n<h3>config.toml設定</h3>\n<p>config.tomlはgatsbyの設定ファイル</p>\n<div class="gatsby-highlight">\n      <pre class="language-yml"><code>blogTitle = "技術忘備録"\nauthorName = "r-tamura"\nauthorDetail = "Web関連多めのソフトウェアエンジニアです。"\nlinkPrefix = ""\ngoogleAnalyticsId = ""\nsyntaxTheme = "ocean"\ntwitterId = "r_tamura30"\nfacebookId = ""\ngithubId = "r-tamura"</code></pre>\n      </div>\n<h2>カスタムドメインの取得</h2>\n<p><a href="http://www.onamae.com/">お名前.com</a>にて取得</p>\n<ul>\n<li>ドメイン名: <code>rtam.xyz</code></li>\n<li>WHOIS情報: お名前.comに委譲</li>\n</ul>\n<h2>CircleCI経由でのデプロイ</h2>\n<p>CircleCIの設定ファイル<code>circle.yml</code>にデプロイ用設定を入力</p>\n<div class="gatsby-highlight">\n      <pre class="language-yml circle.yml"><code>machine:\n  node:\n    version: 7.9.0\ndependencies:\n  override:\n    - yarn install\ntest:\n  override:\n    - echo "skip test..."\ndeployment:\n  production:\n    branch: source # sourceブランチでビルドされた場合のみdeployを行う\n    commands:\n      - git config --global user.name "CircleCI"\n      - git config --global user.email "rtamura30@gmail.com"\n      - npm run clean\n      - npm run build:prefix\n      - npm run deploy\ngeneral:\n  branches:\n    ignore:\n      - master # masterレポジトリpush時はcheckoutしない</code></pre>\n      </div>\n<p>デプロイ先のレポジトリへのDeploy keyがないので、作成してGitHub側に公開鍵, CircleCI側に秘密鍵を登録する</p>\n<h3>鍵の作成</h3>\n<p>rd<em>rsa, rd</em>rsa.pubを生成する</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code>// RSA / 2048bit / コメントなし / パスフレーズもなし\n$ ssh-keygen -t rsa -b 2048 -C <span class="token string">\'\'</span>\nEnter passphrase <span class="token punctuation">(</span>empty <span class="token keyword">for</span> no passphrase<span class="token punctuation">)</span>:\nEnter same passphrase again:\n</code></pre>\n      </div>\n<h3>秘密鍵をCircleへ登録</h3>\n<p>Circle CIダッシュボード > PROJECTS > [ブログプロジェクト] > 右上の歯車マークの設定ボタン > SSH Permissions > Add SSH Key</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>Hostname: github.com\nPrivate Key: id_rsaのテキスト</code></pre>\n      </div>\n<p>上記内容を入力して、Add SSH Keyを選択</p>\n<h3>公開鍵をGitHubへ登録</h3>\n<p><strong>[デプロイ先プロジェクト]</strong> > Settings > Deploy keys > Add deploy key</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>Title: 任意\nKey: id_rsa.pubのテキスト\nAllow write access: チェックする</code></pre>\n      </div>\n<p>上記内容で設定し、Add keyを選択</p>\n<h2>Cloudflare設定</h2>\n<h3>Cloudflareアカウント登録</h3>\n<p><a href="https://www.cloudflare.com/">Cloudflare</a> > Sign up > アカウント情報入力 > Create Account</p>\n<h3>DNS設定</h3>\n<h4>ドメイン名スキャン</h4>\n<p><code>rtam.xyz</code>をテキストボックスに入力して[Scan DNS Records]でスキャンを開始する(1分弱かかる)</p>\n<h4>DNS設定</h4>\n<table>\n<thead>\n<tr>\n<th>設定属性</th>\n<th>設定値</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Type</td>\n<td>A</td>\n</tr>\n<tr>\n<td>Name</td>\n<td>rtam.xyz</td>\n</tr>\n<tr>\n<td>Value</td>\n<td>192.30.252.153, 192.30.252.154</td>\n</tr>\n<tr>\n<td>TTL</td>\n<td>Automatic</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>Follow your DNS provider\'s instructions to create two A records that point your custom domain to the following IP addresses:</p>\n<p>192.30.252.153\n192.30.252.154</p>\n</blockquote>\n<p><a href="https://help.github.com/articles/setting-up-an-apex-domain/#configuring-a-records-with-your-dns-provider">Configuring A records with your DNS provider</a>に記載されているIPを登録する</p>\n<p>上記設定後、Continueを選択</p>\n<p>※GitHubのレポジトリ設定画面で<code>Custom domain</code>にカスタムドメインが設定されていることを確認する</p>\n<p>\n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 15.983606557377051%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAADABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3qAH/8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABBQJ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFRABAQAAAAAAAAAAAAAAAAAAEEH/2gAIAQEAAT8hj//aAAwDAQACAAMAAAAQA8//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAXEAEAAwAAAAAAAAAAAAAAAAABABAh/9oACAEBAAE/ECAwr//Z\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="custom-domain"\n        title=""\n        src="/static/custom-domain-a1a20d1d50db4b9d27ae79dcf7a8b052-55338.jpg"\n        srcset="/static/custom-domain-a1a20d1d50db4b9d27ae79dcf7a8b052-a21e6.jpg 163w,\n/static/custom-domain-a1a20d1d50db4b9d27ae79dcf7a8b052-4ac53.jpg 325w,\n/static/custom-domain-a1a20d1d50db4b9d27ae79dcf7a8b052-55338.jpg 650w,\n/static/custom-domain-a1a20d1d50db4b9d27ae79dcf7a8b052-e3f7a.jpg 732w"\n        sizes="(max-width: 650px) 100vw, 650px"\n      />\n    </span>\n  </span>\n  </p>\n<h4>Cloudflareプラン設定</h4>\n<p> 無料のFree Websiteを設定 > Continueを選択</p>\n<h4>ネームサーバの確認</h4>\n<p>Cloudflareが用意するネームサーバが2つあることを確認し、メモする(次に、DNSレジストラ側でそのDNSサーバを設定するため) > Continueを選択</p>\n<h3>ドメインレジストラのDNSサーバ設定をCloudflareのDNSに設定</h3>\n<p>お名前.comへアクセス > ログイン > 取得したドメインのネームサーバ > 他のネームサーバを利用 > Cloudflareで確認したネームサーバを登録</p>\n<h3>CloudflareでSSL設定</h3>\n<h4>SSL</h4>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>SSL: Frexible</code></pre>\n      </div>\n<p>これによりClient &#x3C;=> Cloudflare 間はHTTPS, Cloudflare &#x3C;=> GitHub 間はHTTPとなる\nGitHubにカスタムドメインの証明書を登録できないためa</p>\n<h4>HTTP Strict Transport Security (HSTS)</h4>\n<table>\n<thead>\n<tr>\n<th>設定属性</th>\n<th>設定値</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Status</td>\n<td>On</td>\n</tr>\n<tr>\n<td>Max-Age</td>\n<td>6 months (recommended)</td>\n</tr>\n<tr>\n<td>Include subdomains</td>\n<td>On</td>\n</tr>\n<tr>\n<td>Preload</td>\n<td>On</td>\n</tr>\n<tr>\n<td>No-sniff</td>\n<td>On</td>\n</tr>\n</tbody>\n</table>\n<h4>Automatic HTTPS Rewrites</h4>\n<p>ONに設定する</p>\n<h1>参考</h1>\n<ul>\n<li><a href="https://circleci.com/docs/1.0/adding-read-write-deployment-key/">Adding read/write deployment key</a> Deploy keyの登録方法</li>\n<li><a href="https://www.kaitoy.xyz/2016/07/01/https-support-by-cloudflare/">CloudflareでブログをHTTPS化</a></li>\n<li><a href="http://qiita.com/superbrothers/items/95e5723e9bd320094537">カスタムドメインの GitHub Pages で HTTPS を使う</a></li>\n<li><a href="https://help.github.com/articles/setting-up-an-apex-domain/#configuring-a-records-with-your-dns-provider">Configuring A records with your DNS provider</a></li>\n<li><a href="https://help.github.com/articles/setting-up-a-custom-subdomain/">Setting up a custom subdomain</a></li>\n</ul>',frontmatter:{tags:["Gatsby","GitHub","Cloudflare","CircleCI","SSL"],title:"Gatsby+GitHub Pages+Cloudflareで静的Webサイト構築",date:"04 May, 2017"}}},pathContext:{slug:"/articles/2017/05/making-blog-site/"}}}});
//# sourceMappingURL=path---articles-2017-05-making-blog-site-e11832fe1c0362df70d0.js.map