{"version":3,"sources":["webpack:///path---articles-2018-02-about-http-vary-field-a5ffa2ca98891fa123c4.js","webpack:///./.cache/json/articles-2018-02-about-http-vary-field.json"],"names":["webpackJsonp","341","module","exports","data","site","siteMetadata","siteUrl","title","authorName","authorDetail","githubId","twitterId","markdownRemark","html","frontmatter","tags","date","fields","slug","pathContext"],"mappings":"AAAAA,cAAc,iBAERC,IACA,SAAUC,EAAQC,GCHxBD,EAAAC,SAAkBC,MAAQC,MAAQC,cAAgBC,QAAA,mBAAAC,MAAA,SAAAC,WAAA,WAAAC,aAAA,yBAAAC,SAAA,WAAAC,UAAA,eAA8JC,gBAAmBC,KAAA,mvIAAg9EC,aAAy1DC,MAAA,QAAAR,MAAA,mBAAAS,KAAA,qBAAsEC,QAAWC,KAAA,8CAAoDC,aAAgBD,KAAA","file":"path---articles-2018-02-about-http-vary-field-a5ffa2ca98891fa123c4.js","sourcesContent":["webpackJsonp([90863965710999],{\n\n/***/ 341:\n/***/ (function(module, exports) {\n\n\tmodule.exports = {\"data\":{\"site\":{\"siteMetadata\":{\"siteUrl\":\"https://rtam.xyz\",\"title\":\"Rの技術メモ\",\"authorName\":\"r-tamura\",\"authorDetail\":\"Web関連多めのソフトウェアエンジニアです。\",\"githubId\":\"r-tamura\",\"twitterId\":\"r_tamura30\"}},\"markdownRemark\":{\"html\":\"<p>HTTP Varyヘッダとはクライアントとサーバ間(以下 オリジンサーバ)にCDN等のキャッシュサーバへキャッシュの扱い方を指定するためのフィールドです。</p>\\n<h1>背景と問題</h1>\\n<p>同じURLへのアクセスでもリクエストに含まれるAccept-Languageヘッダによって言語ごとに異なるレスポンスをサーバが返す場合、\\nキャッシュサーバが<strong>URLのみ</strong>で  「キャッシュを利用するか」/「オリジンサーバへ問い合わせをするか」を判断してしまうと、\\nAccept-Languageヘッダで指定された言語にオリジンサーバが対応しているにもかかわらず、\\nキャッシュサーバが間違ったレスポンスを返してしまう可能性がある。これを解決するのが<code>Vary</code>フィールドです。</p>\\n<h1>Varyフィールド</h1>\\n<p><strong>Vary</strong>フィールドは<a href=\\\"https://tools.ietf.org/html/rfc7231#section-7.1.4\\\">RFC7231</a>で定義されています。<br>\\n以下の図はVaryフィールドを使った異なる言語に対するレスポンスの振り分けの例です。<br>\\nクライアントから3回リクエストが送信されていますが、Varyフィールドで言語ごとのレスポンスをキャッシュサーバへキャッシュしています。</p>\\n<p>\\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 138.93333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAACXBIWXMAAAsSAAALEgHS3X78AAADTUlEQVRIx61WW0gUYRRWK+y2WlhtEGmy5FMo2UsERVEWvUdQIT0EUuaj0gVKAzGI3MXdst3K27iXcV2lh1KyJnOJIFvX3JGdnZ3ZmdmZ2VndsF4WepzOv8zKVls42oGPOZxz/u8//+X8cwoKfhNRFF/JskwkEglCURQiGAzuEgThKrIhIBvP81dIktyDdEmSMrEw7kVBPoGgdDKZVCFQTaVSaigUKge9E+xqLBZTYTDydYTD4f3Ij2wwoQr+pWUSXnbfjLB9Y7zkHBOTQ5MU4zrf3d1t6Orq2oz8Vqt1A9KztpGRkfUWi6Uw12Y2mzctEzKC82gkNlDPia56UcHrhQReNTo6ug5chYBiwAYUp9l+kXy2P4SXPXUzc/a2TzOP773/YL7v/2jpCMw9aQ2ST1tZwVOmmxAybQhRz72zpAMXZBe+sDScgfLV642wzr26CfMFRmJ48cvxBzU9/TcO3Wm7fPzm7UsnLdamw/1Y+5nPs727dRNGOedBOLR0lB9IswKWXvzmy+KHtDBk1k2IpLKyshQ+CPsAuwDb/H5/ncPh2KSbkGKwA5zkpGmunw4zvbSY9NCwrzRkCDp+VxdhXMFPy4tDD2FpU1ISnxJkTzvgBAIruE7RscEqXYSQTecsaVcptldNffepcNodazplNu68BgdBMAL2DpZNwBKv/JNwgni05fVb2/YsxiesxUajcSe4dgDKAUaAoba2dvOKKkVIuHFGGFDFpFtd/Daswn41rrTM8hI2NzcXtbS0rMvCZrMVVlRUbNMy3KtlWWoymUpWVctI8i25urp6y4oIY6LTEo720uiewQmie3VxTUtm4+4qXvIcySLKuXZrgcVaZRgARat+vpBoe4iISjQYtNJDslWbaP2qXxsk2h4acva11OfzncUwbONqXhsTST1/EyTtRDBkJ+YjPQTF9BE0h03Cb6NBFyG84DVCwnOdk1xTUR6bIiM9dtAblZS3UV70NnGS+5juWv4yb1dpru//1HI84WnlxEGFjQ8mRcWtQLa31nKx9wB26qrlXInH48+gQ8AAg+g7PT1dBp3ChVwb/NjPQedgzLXBuO6/dg6oO4DWItM5BAKBChjQiWwsyy53DhRFZToHhmFUmHC5c/gJwFqI8j8H3wQAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"vary-flow-diagram\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/vary-flow-diagram-0cc8ac3ce135855d81980eb6fb4ef1cc-83a8b.png\\\"\\n        srcset=\\\"/static/vary-flow-diagram-0cc8ac3ce135855d81980eb6fb4ef1cc-8992e.png 163w,\\n/static/vary-flow-diagram-0cc8ac3ce135855d81980eb6fb4ef1cc-ae0a7.png 325w,\\n/static/vary-flow-diagram-0cc8ac3ce135855d81980eb6fb4ef1cc-83a8b.png 650w,\\n/static/vary-flow-diagram-0cc8ac3ce135855d81980eb6fb4ef1cc-ea5b0.png 750w\\\"\\n        sizes=\\\"(max-width: 650px) 100vw, 650px\\\"\\n      />\\n    </span>\\n  </span>\\n  </p>\\n<ul>\\n<li>> 1回目のリクエスト<br>\\nキャッシュサーバにキャッシュがない状態ですのでキャッシュサーバからオリジンサーバへ問い合わせが発生します。その際、オリジンサーバは<code>Vary: Accept-Language</code>をレスポンスに付加することで、キャッシュサーバはURLだけでなく、URL + <code>Accept-Language: ja</code>をキーとしてレスポンスをキャッシュします。</li>\\n</ul>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-none\\\"><code>Content-Language: ja\\nVary: Accept-Language</code></pre>\\n      </div>\\n<ul>\\n<li>\\n<p>> 2回目のリクエスト<br>\\nキャッシュサーバに<code>Accept-Language: ja</code>のリクエストが来ましたが、すでにキャッシュに登録されているためキャッシュのレスポンスをクライアントへ返します。<strong>オリジンサーバへのリクエストは発生しません</strong>。</p>\\n</li>\\n<li>\\n<p>> 3回目のリクエスト\\n<code>Accept-Language: en</code>のリクエストが来ましたが、キャッシュサーバにはenのキャッシュはないので、オリジンサーバへ問い合わせ、帰ってきたレスポンスをenでキャッシュして、クライアントへ返します。</p>\\n</li>\\n</ul>\\n<h1>まとめ</h1>\\n<p> 言語によるレスポンス振り分けにおけるキャッシュサーバのキャッシュ制御についての例を確認しました。Varyフィールドは<code>Accept-Language</code>だけでなく、他のフィールド指定や複数のフィールドをカンマで区切ってしていすることもできます。</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-none\\\"><code>Vary: Accept-Encoding, Accept-Language</code></pre>\\n      </div>\\n<p> なお、Varyヘッダではオリジンサーバの対応する形式などをキャッシュサーバへ伝えることができないので、それをできるようにする仕様HTTP Variantsというものも提案されています。<br>\\nそちらについても今後調べてみたいと思います。</p>\\n<h1>参考</h1>\\n<ul>\\n<li><a href=\\\"http://asnokaze.hatenablog.com/entry/2017/10/01/015550\\\">キャッシュサーバの効率を改善するHTTP Variantsという提案仕様 - ASnoKaze blog</a></li>\\n</ul>\",\"frontmatter\":{\"tags\":[\"http\"],\"title\":\"HTTP Varyヘッダについて\",\"date\":\"17 February, 2018\"},\"fields\":{\"slug\":\"/articles/2018/02/about-http-vary-field/\"}}},\"pathContext\":{\"slug\":\"/articles/2018/02/about-http-vary-field/\"}}\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// path---articles-2018-02-about-http-vary-field-a5ffa2ca98891fa123c4.js","module.exports = {\"data\":{\"site\":{\"siteMetadata\":{\"siteUrl\":\"https://rtam.xyz\",\"title\":\"Rの技術メモ\",\"authorName\":\"r-tamura\",\"authorDetail\":\"Web関連多めのソフトウェアエンジニアです。\",\"githubId\":\"r-tamura\",\"twitterId\":\"r_tamura30\"}},\"markdownRemark\":{\"html\":\"<p>HTTP Varyヘッダとはクライアントとサーバ間(以下 オリジンサーバ)にCDN等のキャッシュサーバへキャッシュの扱い方を指定するためのフィールドです。</p>\\n<h1>背景と問題</h1>\\n<p>同じURLへのアクセスでもリクエストに含まれるAccept-Languageヘッダによって言語ごとに異なるレスポンスをサーバが返す場合、\\nキャッシュサーバが<strong>URLのみ</strong>で  「キャッシュを利用するか」/「オリジンサーバへ問い合わせをするか」を判断してしまうと、\\nAccept-Languageヘッダで指定された言語にオリジンサーバが対応しているにもかかわらず、\\nキャッシュサーバが間違ったレスポンスを返してしまう可能性がある。これを解決するのが<code>Vary</code>フィールドです。</p>\\n<h1>Varyフィールド</h1>\\n<p><strong>Vary</strong>フィールドは<a href=\\\"https://tools.ietf.org/html/rfc7231#section-7.1.4\\\">RFC7231</a>で定義されています。<br>\\n以下の図はVaryフィールドを使った異なる言語に対するレスポンスの振り分けの例です。<br>\\nクライアントから3回リクエストが送信されていますが、Varyフィールドで言語ごとのレスポンスをキャッシュサーバへキャッシュしています。</p>\\n<p>\\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 138.93333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAACXBIWXMAAAsSAAALEgHS3X78AAADTUlEQVRIx61WW0gUYRRWK+y2WlhtEGmy5FMo2UsERVEWvUdQIT0EUuaj0gVKAzGI3MXdst3K27iXcV2lh1KyJnOJIFvX3JGdnZ3ZmdmZ2VndsF4WepzOv8zKVls42oGPOZxz/u8//+X8cwoKfhNRFF/JskwkEglCURQiGAzuEgThKrIhIBvP81dIktyDdEmSMrEw7kVBPoGgdDKZVCFQTaVSaigUKge9E+xqLBZTYTDydYTD4f3Ij2wwoQr+pWUSXnbfjLB9Y7zkHBOTQ5MU4zrf3d1t6Orq2oz8Vqt1A9KztpGRkfUWi6Uw12Y2mzctEzKC82gkNlDPia56UcHrhQReNTo6ug5chYBiwAYUp9l+kXy2P4SXPXUzc/a2TzOP773/YL7v/2jpCMw9aQ2ST1tZwVOmmxAybQhRz72zpAMXZBe+sDScgfLV642wzr26CfMFRmJ48cvxBzU9/TcO3Wm7fPzm7UsnLdamw/1Y+5nPs727dRNGOedBOLR0lB9IswKWXvzmy+KHtDBk1k2IpLKyshQ+CPsAuwDb/H5/ncPh2KSbkGKwA5zkpGmunw4zvbSY9NCwrzRkCDp+VxdhXMFPy4tDD2FpU1ISnxJkTzvgBAIruE7RscEqXYSQTecsaVcptldNffepcNodazplNu68BgdBMAL2DpZNwBKv/JNwgni05fVb2/YsxiesxUajcSe4dgDKAUaAoba2dvOKKkVIuHFGGFDFpFtd/Daswn41rrTM8hI2NzcXtbS0rMvCZrMVVlRUbNMy3KtlWWoymUpWVctI8i25urp6y4oIY6LTEo720uiewQmie3VxTUtm4+4qXvIcySLKuXZrgcVaZRgARat+vpBoe4iISjQYtNJDslWbaP2qXxsk2h4acva11OfzncUwbONqXhsTST1/EyTtRDBkJ+YjPQTF9BE0h03Cb6NBFyG84DVCwnOdk1xTUR6bIiM9dtAblZS3UV70NnGS+5juWv4yb1dpru//1HI84WnlxEGFjQ8mRcWtQLa31nKx9wB26qrlXInH48+gQ8AAg+g7PT1dBp3ChVwb/NjPQedgzLXBuO6/dg6oO4DWItM5BAKBChjQiWwsyy53DhRFZToHhmFUmHC5c/gJwFqI8j8H3wQAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"vary-flow-diagram\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/vary-flow-diagram-0cc8ac3ce135855d81980eb6fb4ef1cc-83a8b.png\\\"\\n        srcset=\\\"/static/vary-flow-diagram-0cc8ac3ce135855d81980eb6fb4ef1cc-8992e.png 163w,\\n/static/vary-flow-diagram-0cc8ac3ce135855d81980eb6fb4ef1cc-ae0a7.png 325w,\\n/static/vary-flow-diagram-0cc8ac3ce135855d81980eb6fb4ef1cc-83a8b.png 650w,\\n/static/vary-flow-diagram-0cc8ac3ce135855d81980eb6fb4ef1cc-ea5b0.png 750w\\\"\\n        sizes=\\\"(max-width: 650px) 100vw, 650px\\\"\\n      />\\n    </span>\\n  </span>\\n  </p>\\n<ul>\\n<li>> 1回目のリクエスト<br>\\nキャッシュサーバにキャッシュがない状態ですのでキャッシュサーバからオリジンサーバへ問い合わせが発生します。その際、オリジンサーバは<code>Vary: Accept-Language</code>をレスポンスに付加することで、キャッシュサーバはURLだけでなく、URL + <code>Accept-Language: ja</code>をキーとしてレスポンスをキャッシュします。</li>\\n</ul>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-none\\\"><code>Content-Language: ja\\nVary: Accept-Language</code></pre>\\n      </div>\\n<ul>\\n<li>\\n<p>> 2回目のリクエスト<br>\\nキャッシュサーバに<code>Accept-Language: ja</code>のリクエストが来ましたが、すでにキャッシュに登録されているためキャッシュのレスポンスをクライアントへ返します。<strong>オリジンサーバへのリクエストは発生しません</strong>。</p>\\n</li>\\n<li>\\n<p>> 3回目のリクエスト\\n<code>Accept-Language: en</code>のリクエストが来ましたが、キャッシュサーバにはenのキャッシュはないので、オリジンサーバへ問い合わせ、帰ってきたレスポンスをenでキャッシュして、クライアントへ返します。</p>\\n</li>\\n</ul>\\n<h1>まとめ</h1>\\n<p> 言語によるレスポンス振り分けにおけるキャッシュサーバのキャッシュ制御についての例を確認しました。Varyフィールドは<code>Accept-Language</code>だけでなく、他のフィールド指定や複数のフィールドをカンマで区切ってしていすることもできます。</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-none\\\"><code>Vary: Accept-Encoding, Accept-Language</code></pre>\\n      </div>\\n<p> なお、Varyヘッダではオリジンサーバの対応する形式などをキャッシュサーバへ伝えることができないので、それをできるようにする仕様HTTP Variantsというものも提案されています。<br>\\nそちらについても今後調べてみたいと思います。</p>\\n<h1>参考</h1>\\n<ul>\\n<li><a href=\\\"http://asnokaze.hatenablog.com/entry/2017/10/01/015550\\\">キャッシュサーバの効率を改善するHTTP Variantsという提案仕様 - ASnoKaze blog</a></li>\\n</ul>\",\"frontmatter\":{\"tags\":[\"http\"],\"title\":\"HTTP Varyヘッダについて\",\"date\":\"17 February, 2018\"},\"fields\":{\"slug\":\"/articles/2018/02/about-http-vary-field/\"}}},\"pathContext\":{\"slug\":\"/articles/2018/02/about-http-vary-field/\"}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/json-loader!./.cache/json/articles-2018-02-about-http-vary-field.json\n// module id = 341\n// module chunks = 90863965710999"],"sourceRoot":""}