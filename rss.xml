<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Rの技術メモ]]></title><description><![CDATA[主にWeb業界で働くエンジニアの忘備録ブログです。]]></description><link>https://rtam.xyz</link><generator>RSS for Node</generator><lastBuildDate>Fri, 18 Jan 2019 14:50:49 GMT</lastBuildDate><item><title><![CDATA[Unixのwaitコマンド]]></title><description><![CDATA[2019年最初の記事はUnixの wait コマンドについて。 wait コマンドはLinuxに通常built-inで組み込まれているコマンドで、機能は 実行されている他のプロセスの終了を待つ こと。 コマンド引数には待つ対象のプロセスID…]]></description><link>https://rtam.xyz/articles/2019/01/unix-wait-command/</link><guid isPermaLink="false">https://rtam.xyz/articles/2019/01/unix-wait-command/</guid><pubDate>Fri, 18 Jan 2019 21:20:26 GMT</pubDate><content:encoded>&lt;p&gt;2019年最初の記事はUnixの&lt;code&gt;wait&lt;/code&gt;コマンドについて。&lt;code&gt;wait&lt;/code&gt;コマンドはLinuxに通常built-inで組み込まれているコマンドで、機能は&lt;strong&gt;実行されている他のプロセスの終了を待つ&lt;/strong&gt;こと。 コマンド引数には待つ対象のプロセスIDを指定することができ、もし引数を指定しない場合は全ての子プロセスの終了を待つ。&lt;code&gt;wait&lt;/code&gt;は現在の実行環境のジョブテーブルを参照するため、&lt;code&gt;cd&lt;/code&gt;のようにシェルビルトインとして実装されている。(シェルビルトインは外部プログラムではなくシェル自体に組み込まれているコマンド&lt;a href=&quot;https://en.wikipedia.org/wiki/Shell_builtin&quot;&gt;1&lt;/a&gt;)&lt;/p&gt;
&lt;h1&gt;基本的な使い方&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;wait&lt;/code&gt;コマンドこシンタックスは以下だ。 自分は複数の重い処理をバックグラウンドで同時に実行した場合の全プロセスの完了同期をするときに使う。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-none&quot;&gt;&lt;code&gt;wait [n]

# n    : 待つ対象の プロセスID or ジョブID (現在実行されているバックグラウンドプロセスのジョブID)&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;例1 指定したプロセスを待つ&lt;/h3&gt;
&lt;h4&gt;サンプルプログラム1&lt;/h4&gt;
&lt;p&gt;子プロセスが終了するまで、プロセスがブロッキングし、 子プロセスの返り値を自身の返り値とする。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-sh&quot;&gt;&lt;code&gt;#!/usr/bin/env bash

success_process () {
  sleep 3
  true
}

fail_process () {
  sleep 3
  return 100
}

success_process &amp;
pid1=$!
echo &quot;waiting process 1&quot;
wait $pid1
echo &quot;process 1 exited with $?&quot;

fail_process &amp;
pid2=$!
echo &quot;waiting process 2...&quot;
wait $pid2
echo &quot;process 2 exited with $?&quot;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h4&gt;Output&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-sh&quot;&gt;&lt;code&gt;$ bash wait_1.sh
waiting process 1
process 1 exited with 0    # 3秒後に0を返す
waiting process 2...
process 2 exited with 100  # 3秒後に100を返す&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;例2 全ての子プロセスの終了を待つ&lt;/h3&gt;
&lt;h4&gt;サンプルプログラム2&lt;/h4&gt;
&lt;p&gt;子プロセスが終了するまで、プロセスがブロッキングし、 子プロセスの返り値を自身の返り値とする。
重たいプロセスを想定した関数を5つ呼び出す。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-sh&quot;&gt;&lt;code&gt;#!/usr/bin/env bash
heavey_process () {
  sleep $1
}

for i in {1..5}
do
  # Run command in background
  heave5_process $i &amp;
done

wait
echo &quot;all process finished&quot;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h4&gt;Output&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-sh&quot;&gt;&lt;code&gt;$ bash wait_2.sh
all process finished   # ほぼ5秒後に終了&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;例3 子プロセスが存在しない場合&lt;/h3&gt;
&lt;h4&gt;サンプルプログラム3&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-sh&quot;&gt;&lt;code&gt;#!/usr/bin/env bash

sleep 5 &amp;
pid=$1
kill $1
wait $1
echo $1 was terminated. exited with $?&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h4&gt;Output&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-sh&quot;&gt;&lt;code&gt;$ bash wait_3.sh
wait_3.sh: line 6:    79 Terminated              sleep 5
79 was terminated. exited with 143               # すぐに終了&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;どうやら今回の環境ではプロセスが存在しない場合は143を返すよう。&lt;/p&gt;
&lt;h1&gt;カーネルの観点から&lt;/h1&gt;
&lt;p&gt;子プロセスは正常終了・異常終了にかかわらず、プロセスを終了するときに自身の親プロセスへSIGCHILDシグナルを送信する。親プロセスはシグナルを無視するかシグナルハンドラーを実行するかを選択できるが、デフォルト動作は無視となっている。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://linuxhint.com/wait_command_linux/&quot;&gt;Wait Command in Linux – Linux Hint&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.gnu.org/software/bash/manual/bashref.html#index-wait&quot;&gt;Bash Reference Manual&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;[&lt;a href=&quot;https://en.wikipedia.org/wiki/Shell_builtin&quot;&gt;Shell builtin - Wikipedia&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[WebAssembly's post-MVP futureを読んで Part1]]></title><description><![CDATA[ここ数年、Webに多数の機能が追加されているが、自分は最近WebAssemblyについて改めて調べることが多くなってきており、そんな中、WebAssemblyに求められるものについて分かりやすく書かれていた WebAssembly's post-MVP future: A…]]></description><link>https://rtam.xyz/articles/2018/11/webassembly-post-mvp-part1/</link><guid isPermaLink="false">https://rtam.xyz/articles/2018/11/webassembly-post-mvp-part1/</guid><pubDate>Sun, 25 Nov 2018 13:06:31 GMT</pubDate><content:encoded>&lt;p&gt;ここ数年、Webに多数の機能が追加されているが、自分は最近WebAssemblyについて改めて調べることが多くなってきており、そんな中、WebAssemblyに求められるものについて分かりやすく書かれていた&lt;a href=&quot;https://hacks.mozilla.org/2018/10/webassemblys-post-mvp-future/&quot;&gt;WebAssembly&apos;s post-MVP future: A cartoon skill tree - Mozilla Hacks - the Web developer blog&lt;/a&gt;という記事を見つけたので、その記事を中心にしてWebAssemblyについてメモをしていく。そちらの記事自体が長いため数パートに分けて書いていこうと思う。&lt;/p&gt;
&lt;p&gt;その記事では以下のような内容が書かれている。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;・MVP (Minimum Viable Product)&lt;/li&gt;
&lt;li&gt;・これから必要となる/実装されている機能&lt;/li&gt;
&lt;li&gt;・他の言語機能との比較&lt;/li&gt;
&lt;li&gt;・ブラウザの外側&lt;/li&gt;
&lt;li&gt;・Node.js&lt;/li&gt;
&lt;li&gt;・CDN, Serverless and Edge Computing&lt;/li&gt;
&lt;li&gt;・Portable CLI tools&lt;/li&gt;
&lt;li&gt;・Internet of Things&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;WebAssemblyという名前ではあるが、ブラウザの中だけでなく、Node.jsやJavaScriptのエコシステムなどの関わり合いについて求められるものがまとめられているようだ。&lt;/p&gt;
&lt;h3&gt;WebAssembly&lt;/h3&gt;
&lt;p&gt;WebAssemblyとは何かという分かりやすい説明が、本&lt;a href=&quot;https://www.packtpub.com/web-development/learn-webassembly&quot;&gt;Learn WebAssembly&lt;/a&gt;にかかれている。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;WebAssemly is a compiler target for progmrams on the Web.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;MVP (Minimum Viable Product) の第一歩&lt;/h3&gt;
&lt;p&gt;WebAssemblyのストーリーはEmscriptenから始まった。EmscriptenはもともとC++のコードで書かれたプログラムをJavaScriptへ変換するツールで、このツールのおかげでゲームやデスクトップアプリなどの巨大なC++コードがWeb環境で動くようになった。&lt;/p&gt;
&lt;p&gt;動くようになったものの、この変換で生成されたJavaScriptコードはとても遅くなってしまう。Mozillaによって型付けすることでコードがとても速く動くようになることが発見された。これがasm.jsと呼ばれるJavaScriptのサブセットである。他のブラウザでも取り入れられていったが、より速くする仕組みが求められ、ついにWebAssemlyというJavaScriptとは別の新しい言語の仕様が設計された。ここで、CやC+のコードがWeb上で効率よく実行されるにはWebAssemblyには何が必要であるかということが初めに考えられた。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Compile target&lt;/strong&gt;、&lt;strong&gt;Fast execution&lt;/strong&gt;、&lt;strong&gt;Compact&lt;/strong&gt;、&lt;strong&gt;Linear memory&lt;/strong&gt;がその4本柱として挙げられた。&lt;/p&gt;
&lt;h4&gt;Compile target&lt;/h4&gt;
&lt;p&gt;多くの言語をサポートできるようコンパイルターゲットで物理的になCPUのマシンコードではなく、仮想マシン(Conceptual Machine/JVMのような)上で動くバイトコード。&lt;/p&gt;
&lt;h4&gt;Fast execution&lt;/h4&gt;
&lt;p&gt;ユーザ体験を損なわない速さが要求される&lt;/p&gt;
&lt;h4&gt;Compact&lt;/h4&gt;
&lt;p&gt;コードのロード時間を最小限に抑えることが要求される。インストール型のデスクトップアプリとは異なり、Webはダウンロードが発生する場所がとても多い。LLVMのIRをそのまま使わないのはこのため。&lt;/p&gt;
&lt;h4&gt;Linear memory&lt;/h4&gt;
&lt;p&gt;ポインタを実装する必要があるが、そのままメモリにアクセスできるものではセキュアでないので、TypedArrayのようなメモリアクセス用のAPIが必要である。&lt;/p&gt;
&lt;h3&gt;処理の重いデスクトップアプリへの対応&lt;/h3&gt;
&lt;p&gt;WeAssemblyはブラウザで動くようになったが、それですべてではなく今後もその機能は拡張され続けていく。Photoshopがブラウザの上で動作したり、Gmailが即座に読み込まれるのを想像できるだろうか。AutodestkのAutoCADやAdobeのLightroomがWebAssemblyを使ってブラウザ上で動くことが実証されているが、重たいアプリケーションをブラウザ上でスムーズに動作するようにするにはまだ必要なものがある。&lt;strong&gt;Threading&lt;/strong&gt;, &lt;strong&gt;SIMD&lt;/strong&gt;, &lt;strong&gt;64-bit addressing&lt;/strong&gt;, &lt;strong&gt;Streaming compilation&lt;/strong&gt;, &lt;strong&gt;Implicit HTTP caching&lt;/strong&gt;などである。&lt;/p&gt;
&lt;h4&gt;Threading&lt;/h4&gt;
&lt;p&gt;より早くプログラムを動かすためには複数のCPUコアで同時に処理を実行することが必要である。現状のWebAssemblyではシングルスレッドのみ可能なので、マルチスレッドプログラミングが可能となるようにすることが必要である。
Chrome70ではpthreadプログラムされたC/C++プログラムをWebAssemblyで実行できるよう実装し、&lt;a href=&quot;&quot;&gt;Origin Trial&lt;/a&gt;とした。
&lt;a href=&quot;https://developers.google.com/web/updates/2018/10/wasm-threads&quot;&gt;https://developers.google.com/web/updates/2018/10/wasm-threads&lt;/a&gt;&lt;/p&gt;
&lt;h4&gt;SIMD&lt;/h4&gt;
&lt;p&gt;メモリを小さな塊に分割して一つの演算命令（インストラクション）を複数のデータに同時に実行する。こちらも並列計算の手法の一種で、現在使われているCPUのほとんどがこの演算機能を備えている。&lt;/p&gt;
&lt;h4&gt;64-bit addressing&lt;/h4&gt;
&lt;p&gt;64bitのメモリ空間ならば、実質ハードウェアの限界までアドレス空間を使用できる。&lt;/p&gt;
&lt;h4&gt;Streaming compilation&lt;/h4&gt;
&lt;p&gt;実行速度だけでなくロード速度もより早くすることが求められる。Streaming compilationではWebAssemblyファイルをダウンロードしながら、コンパイルしていく。ダウンロードが終わっているときにはコンパイルもほとんど終わっている。firefoxではStreaming compilationの機能を実装済みで他のブラウザも実装中である。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Reference: &lt;a href=&quot;https://hacks.mozilla.org/2018/01/making-webassembly-even-faster-firefoxs-new-streaming-and-tiering-compiler/&quot;&gt;https://hacks.mozilla.org/2018/01/making-webassembly-even-faster-firefoxs-new-streaming-and-tiering-compiler/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Implicit HTTP caching&lt;/h4&gt;
&lt;p&gt;現状のWebAssemblyでは同じコードを2つのページで読み込んだ場合に、そのたびにコンパイルが実行されてしまう。コンパイルされたコードもHTTP Cacheへストアして、同じwasmを読み込む場合には事前にコンパイルされたコードをキャッシュから取り出すようにすることで、コンパイルをスキップすることができる。&lt;/p&gt;
&lt;h3&gt;各機能の現状(2018/10)&lt;/h3&gt;
&lt;p&gt;ここまでに挙げられた機能の仕様/実装状況&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Feature&lt;/th&gt;
&lt;th&gt;Status&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Threading&lt;/td&gt;
&lt;td&gt;仕様はほぼ固まっている(Spectre問題により
&lt;a href=&quot;https://www.packtpub.com/web-development/learn-webassembly&quot;&gt;SharedArrayBufferがブラウザにより機能をオフにされている&lt;/a&gt;
こと以外)。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SIMD&lt;/td&gt;
&lt;td&gt;開発中&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;64-bit addressing&lt;/td&gt;
&lt;td&gt;実装のために必要な仕様大体できている。x86やARMが64bit対応した時に近い方法で実現できる&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Streaming compilation&lt;/td&gt;
&lt;td&gt;Firefoxでは実装済み、他ブラウザーも開発中&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Implicit HTTP cache&lt;/td&gt;
&lt;td&gt;サポート間近&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;まとめ&lt;/h2&gt;
&lt;p&gt;このパートではWebAssemblyがMVPのはじめとして求められたもの、今後は求めらている機能とその開発状況についてまとめらた。ゲームなどのアプリケーション全体がWebAssemblyでできているアプリケーションは自分の環境からするとあまり遭遇することはなさそうだが、次のパートではアプリケーションの一部のみをWebAssemblyとするアプリがどのようにJavaScriptと連携していくかということに焦点を当てて見ていく。&lt;/p&gt;
&lt;h2&gt;参考&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://hacks.mozilla.org/2018/10/webassemblys-post-mvp-future/&quot;&gt;WebAssembly&apos;s post-MVP future: A cartoon skill tree - Mozilla Hacks - the Web developer blog&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.packtpub.com/web-development/learn-webassembly&quot;&gt;Learn WebAssembly&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[1.1.1.1のSSL]]></title><description><![CDATA[2018/4/1からCDNのCloudflareがIPアドレス 1.1.1.1 をDNSサーバとして運用を開始した。
 1.1.1.1 ではWebサーバも公開されており、アクセスしてみた際にドメインではなくで  https://1.1.1.1  という IPアドレスでSSL…]]></description><link>https://rtam.xyz/articles/2018/05/ssl-san-ipaddress/</link><guid isPermaLink="false">https://rtam.xyz/articles/2018/05/ssl-san-ipaddress/</guid><pubDate>Sat, 12 May 2018 12:00:00 GMT</pubDate><content:encoded>&lt;p&gt;
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 51.935788479697834%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAChElEQVQozx2TyW7TUBSG/QBILEBFFAQkgdLQzMEZiWtnNJmcxJndxknsDB3UCaKWFkFhB+IJeNmPK3Z3ce4/nf9I53aNjWtws+qw6OWppIPIfg+RnVdEdz3IgbekQn56hTSrtoapxalmItiDAu68zrnT4MY1ObV0ziY1pE9ui+tVl/WwzOXUEIAhAt7npIKvefvyKY10mEUlw6KQ4mrSppeXSQoiU5eZWCrLjsp0P85KiOmX4khXTof1qMKsnuVI/8BHAeB9toXn6WO2Hj6gFHrDeX2fdSXHQInRzQZRBJmhyaxGJYygj3E+zpXT/i9Ksowsp+MybluhuufBysXwbm/he/aETHiPajLEUVXhtJFnKGzbgrSZDpALehnkIjQiXq6XJj8/T7m/mCAtZnXmQ41Fv0AnF2KU9JPZ8xF97eHu6py11eP3Zs33Y5s/txf8/XXPtdPFSOzSiO8IdRFulm028yaXYh/StJtnLqS7h01ss0Aj6qGdCeDffkSvpLAydTaHBs7HHN+WY34cH3AmrDl6imrYw0RPsO5rzBppFl0NaTko/vd+NBJLcTv01Bh2KYkusiyHfRwUZGZFmZHIbq6n2dhNjoSIqXhbYnbdK+KaKmNB0C8nkE4Oqtyejrg9HvJVZHBiG7i1LEuzTEuRWTZVjkVdFjWFSSnF3bzDF1ETt66wNBTcboVDQ6NVTNLWYkjuQMMSC3GFbccqMWxmMFI74kNO9LLO5ajGrJximIszLWc5MfLY2nuqwReMizGKCT9KzIv63kdLjSI5VpFRX2XSFz0yMlSUAK39MNOSzELPcqgKIAEwyAQxE3u0E+9Q32xTi/rEMYy5dAbUxHwlvYtVTfEPJpV3PQcQSmkAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;1.1.1.1_web&quot;
        title=&quot;&quot;
        src=&quot;/static/1.1.1.1_web-c0f6796e1f605dccbcc075c30c02a16b-83a8b.png&quot;
        srcset=&quot;/static/1.1.1.1_web-c0f6796e1f605dccbcc075c30c02a16b-8992e.png 163w,
/static/1.1.1.1_web-c0f6796e1f605dccbcc075c30c02a16b-ae0a7.png 325w,
/static/1.1.1.1_web-c0f6796e1f605dccbcc075c30c02a16b-83a8b.png 650w,
/static/1.1.1.1_web-c0f6796e1f605dccbcc075c30c02a16b-50453.png 975w,
/static/1.1.1.1_web-c0f6796e1f605dccbcc075c30c02a16b-8b09e.png 1059w&quot;
        sizes=&quot;(max-width: 650px) 100vw, 650px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  &lt;/p&gt;
&lt;p&gt;2018/4/1からCDNのCloudflareがIPアドレス&lt;code&gt;1.1.1.1&lt;/code&gt;をDNSサーバとして運用を開始した。
&lt;code&gt;1.1.1.1&lt;/code&gt;ではWebサーバも公開されており、アクセスしてみた際にドメインではなくで &lt;a href=&quot;https://1.1.1.1&quot;&gt;https://1.1.1.1&lt;/a&gt; という&lt;strong&gt;IPアドレスでSSL接続していた&lt;/strong&gt;ことに疑問を覚えたので仕組みを調べてみた。&lt;/p&gt;
&lt;p&gt;
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 279px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 13.261648745519713%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAg0lEQVQI132MwQ6CMBBE+f9fNBpB2912KW0BEz09oeHARSd5mdnJZDsVJWjAomEhIiKIF+KW9y6o4pzDe48/fN+0+8hnuuvYM4QHmpQhOl6fN8uSubg7N+nJOTHa/rwwpcQyV/6pi5Ohpg2xwFQKtRZ8FAZ5YmaUrcu5NJ9rZV3Xn3wBwJfio7QHz90AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;url&quot;
        title=&quot;&quot;
        src=&quot;/static/url-8329cec74d5dca11ddfedecae489e414-5222b.png&quot;
        srcset=&quot;/static/url-8329cec74d5dca11ddfedecae489e414-c4632.png 163w,
/static/url-8329cec74d5dca11ddfedecae489e414-5222b.png 279w&quot;
        sizes=&quot;(max-width: 279px) 100vw, 279px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  &lt;/p&gt;
&lt;h1&gt;証明書の中身を確認&lt;/h1&gt;
&lt;p&gt;CN, SANで&lt;code&gt;1.1.1.1&lt;/code&gt;という値が指定されているはずと考えられるので、まずはブラウザから証明書の中身を確認してみる。&lt;/p&gt;
&lt;p&gt;
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 61.79401993355482%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACDElEQVQoz4VTyXKbUBDk/78oSeWSQ3JyLiljC8QidgESy2OJA0Kd6ZFJ+ZapevUWtXpmehrr8PqCJEmR5wWyLMf5XKIsS9nP+sa77/t4sZ8RRTGqqtLf6rrW9biXstfwPA9WGJ4wDAOyNFUiYwa0bYtxHLGuK+53oCgKJR2GEangSND3RnAdxmnGsqzYtrvirCLPMU+TEkyydx1BE263m5DdIXyPDrJMcAPGoceftwmmbyWBnH9PwH3TxFmawQp8D97RRRInWCVTJVXyz1VZaQIGW/U9H59+xPj8NOC7A3x56vD1Z4tvz29wckm8bQiDENZB+nbcI1zHxTzPQpbDPTiSxEPbtEp4lHMQHGG/HhHEFbpxQ5SIZmGOojYY5kVa3uC6Liw/DGDbtorKuF4uWm0hA9krDPwAXuBL67H8dpJqVjSXCqmck+gkMph/nchQQsRxjFoIKbQxRgCjaGRU10UGk4o24SnUJGmS6TsX8RwoEy/LogOzWKbzekAcRaobCef3obANBm1CDc/FWRL1+q4De18fcVYsZbJN+okDuYi3mutVLbMHgZThf1GKnaxduz1oGRq2l0qaptE9SRL1KGOvju9MRJsRx51eti5S3Q5UQtHmKhVypz6cPLVhEgbJGNSNRA+ckbs4RDxtEcyvo+t6XTzvZBSdlbliK1bJL+Ujjnfiro1RO/2yPfwFxtqKyYVU7dEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;san.png&quot;
        title=&quot;&quot;
        src=&quot;/static/san-52e3606eea7346562ba3b5a92b5ec8a2-83a8b.png&quot;
        srcset=&quot;/static/san-52e3606eea7346562ba3b5a92b5ec8a2-8992e.png 163w,
/static/san-52e3606eea7346562ba3b5a92b5ec8a2-ae0a7.png 325w,
/static/san-52e3606eea7346562ba3b5a92b5ec8a2-83a8b.png 650w,
/static/san-52e3606eea7346562ba3b5a92b5ec8a2-50453.png 975w,
/static/san-52e3606eea7346562ba3b5a92b5ec8a2-215a8.png 1204w&quot;
        sizes=&quot;(max-width: 650px) 100vw, 650px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  &lt;/p&gt;
&lt;p&gt;SANのところで&lt;code&gt;IP Address=1.1.1.1&lt;/code&gt;という項目があり、他にも&lt;code&gt;1.0.0.1&lt;/code&gt;やIPv6形式のアドレスもあることがわかる。
確かに証明書の中にはIPアドレスで指定されているようだ。そこで、実際に証明書の仕様を確認してみる。&lt;/p&gt;
&lt;h1&gt;RFC仕様&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;&quot;&gt;RFC5280&lt;/a&gt;のSANの構造を見てみると以下のようになっている。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-none&quot;&gt;&lt;code&gt;  SubjectAltName ::= GeneralNames

  GeneralNames ::= SEQUENCE SIZE (1..MAX) OF GeneralName

  GeneralName ::= CHOICE {  
    otherName                       [0]     OtherName,  
    rfc822Name                      [1]     IA5String,  
    dNSName                         [2]     IA5String,  
    x400Address                     [3]     ORAddress,  
    directoryName                   [4]     Name,  
    ediPartyName                    [5]     EDIPartyName,  
    uniformResourceIdentifier       [6]     IA5String,  
    iPAddress                       [7]     OCTET STRING,  
    registeredID                    [8]     OBJECT IDENTIFIER 
  }  &lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;SANには[7]で&lt;strong&gt;IPアドレス&lt;/strong&gt;も指定できることがわかる。他にもいろいろなものが指定できることも確認できる。仕様がわかったので、次はパケットの中身をみてみる。&lt;/p&gt;
&lt;h1&gt;パケットキャプチャをしてみる&lt;/h1&gt;
&lt;p&gt;WiresharkでSSLハンドシェイク時のパケットをキャプチャし、サーバからのレスポンスCertificateのSAN部分のバイナリデータとWireshark上で見える内容を確認してみる。&lt;/p&gt;
&lt;p&gt;
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 609px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 102.79146141215105%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAD0klEQVQ4y32USXPbRhCF+Y9VysWKE5cWH3Pzzbdck7NsSa6SpaRSkiNuIEiQBMAFGwkC3Elwkbi8vB5atpKKNFVdAAn0hzfdryc1HA7R6/XQ7/cRxzEq1QrS6TTK5TJKpSKq/J3P5ZDP5/Dl9oZXDb7nwmk20Ww0UKvV0Ol0MJslOHj1Cin8Z61WD3BdD1a9CbvuoNsfwvVbaHViPKy3WD6skcyXGE9njDn6wzGWq43KPTw+2QE3mw222y02Eps14sEIutlAWiujHsQwrCa0so2a30E4SBCPFxgvt0hWUDFabLAk5/Wbox1QYI8haz6bwbQJzBfhBB3U3QB6xUbDa8Nrx/zgBNPlCgvC5g9bzO4piHk/H74A1Gwf1zkTWTuE1ujirtpCNUxQ792jNQP8CeCNtwzAHW0Q3QM/vH4B2Ap82JaJiAXvxhFcx8EsmWLNGu/W9vt1u6vh8fEzQOmY03TYZQMhgfVaHbYt3YyQ8GPL5RLf84D1Zgc8OvofoMSMSQ4VlY2yAopFbNojaLHbjOl0SjesvkE3zwEf1yxJ4PsePVlVQNdpwrJt2slFm8DxhE2ZJi8DH+0jX5Ya+h6BFQLDEB5BNoGe7yOKOhgMhphMps8Dv/mQV5kYSRT3y/YE4BBoWZYCJWzMaDRS783nC5W3Xq//DXy61usVt+sT4qHbjdHlWC4WC4JmvM4JmfM+gYys3D9dJyfHSHmerxrgOO7XcGCaJmfYRIOz2mRDRPHTkA8GQQuSK88bjDDsYH9/HylJKhQK6kAoFHTouo5MJotisQSDXdb5n6ZpyGSzfFZEjgdFnTm9Xp9lsOEHgaqvcA4OfkQqiiKqqcKiKnnBskxVr8bXk6ReFw9aqkGWVds1in6UMkjuYDCg2gBR3KWxuWXZolaggnRGqRK1mlZAifdyhIniXC6LXOYOTcuAbeQRBh6BS+UA8adtVjGK2ziWpoTtNv+0WbeqmoaaujeVMjnvJKFOhX9yrn+9auL9mYF0rY/xoEdv1hCFLaR1C6daFz+9OURK5Op6AdlsjrXLQMvn1SEq6qQUorpc0nH+VwHvTsv45fc0/ijS3MMeqqYF323i6jaP326CHVDqUGGybNUwDIIMQoq7urKWAjaZWDMrCBoVOFYRUdtXdpJytbhDmaRxr00fEijHfokAqZWA8lSYplIZO/mAdFieFdjhcoXHWS7PmW7T3EP6tKu8OOEo9voD+vAtUjc3Nzg/P8eni0+4/PyZ1wv+vsDV1TUuLy9x9vEjzs7OVFzw2YcPp7i9/aJEXF9f4++7O2U5EbO3t4d/AO3P8itz9xn4AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;captured_san.png&quot;
        title=&quot;&quot;
        src=&quot;/static/captured_san-acfc1b249fe07c5e6342a95b3413d600-d6c9d.png&quot;
        srcset=&quot;/static/captured_san-acfc1b249fe07c5e6342a95b3413d600-df0dd.png 163w,
/static/captured_san-acfc1b249fe07c5e6342a95b3413d600-239af.png 325w,
/static/captured_san-acfc1b249fe07c5e6342a95b3413d600-d6c9d.png 609w&quot;
        sizes=&quot;(max-width: 609px) 100vw, 609px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  &lt;/p&gt;
&lt;p&gt;バイナリ部分の&lt;code&gt;87 04&lt;/code&gt;が何を意味しているはわからないが、IPアドレスがオクテット形式でデーター多として見える。&lt;/p&gt;
&lt;h1&gt;まとめ&lt;/h1&gt;
&lt;p&gt;SSL証明書のサブジェクトにIPアドレスが使えることが分かった。今回はRFCを読み、実際にパケットをキャプチャしてみることで仕組みを理解することができた。インターネット上の仕様はいろいろなサイトで解説されているが、全てがRFCを元としているので、わからないことがあったら今後はRFCまで調査するように心がけていきたい。&lt;/p&gt;
&lt;h1&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.cloudflare.com/announcing-1111/&quot;&gt;Announcing 1.1.1.1: the fastest, privacy-first consumer DNS service&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&quot;&quot;&gt;rfc5280&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[「人工知能の作り方 ―「おもしろい」ゲームAIはいかにして動くのか」を読んで]]></title><description><![CDATA[人工知能の作り方 ―「おもしろい」ゲームAIはいかにして動くのか を読んで面白かった部分のメモと感想。 各章メモ…]]></description><link>https://rtam.xyz/articles/2018/03/how-to-make-an-artificial-intelligence/</link><guid isPermaLink="false">https://rtam.xyz/articles/2018/03/how-to-make-an-artificial-intelligence/</guid><pubDate>Sat, 31 Mar 2018 10:05:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;http://gihyo.jp/book/2017/978-4-7741-8627-6&quot;&gt;人工知能の作り方 ―「おもしろい」ゲームAIはいかにして動くのか&lt;/a&gt;を読んで面白かった部分のメモと感想。&lt;br&gt;
&lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 160px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 141.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAcABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIDBAX/xAAXAQEBAQEAAAAAAAAAAAAAAAAAAQME/9oADAMBAAIQAxAAAAHVWxlRpEYUYGfTmsEYn//EABsQAAMBAAMBAAAAAAAAAAAAAAECAwAREhMz/9oACAEBAAEFAjXeowdeGC9SBQQ+dqu+Qtpl5rxlPUlzv//EABkRAQACAwAAAAAAAAAAAAAAAAEAAxARMf/aAAgBAwEBPwHBcxsd9n//xAAXEQEAAwAAAAAAAAAAAAAAAAAAEBES/9oACAECAQE/AYyp/8QAHhAAAgEDBQAAAAAAAAAAAAAAAAERAiExEiAiQZH/2gAIAQEABj8CsjmoLT4Mx0ZIpqSRUo1SoIaWz//EABwQAQEBAQEAAwEAAAAAAAAAAAERACExQVFxYf/aAAgBAQABPyFY1Z/HWI1LOObRY/InCuARXPZ4qriELUe98wilek7hifSCTVFr26clDv7kPgfm/9oADAMBAAIAAwAAABDMPD//xAAZEQADAAMAAAAAAAAAAAAAAAAAAREhMaH/2gAIAQMBAT8QSoxXD0WI3D//xAAYEQEBAAMAAAAAAAAAAAAAAAABABARMf/aAAgBAgEBPxBcJg65f//EAB8QAQACAgICAwAAAAAAAAAAAAERIQAxUWFBgXGh8P/aAAgBAQABPxATKJ2AwhxW8TAtBbHFXW83R8Bn3GIksCD5X6MAkFRNgbkHvzkshSUJcYOI4GXa8XikEGjfZWC09MO5/R6y2QhmcGtIqNEyhDKAVn//2Q==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;image&quot;
        title=&quot;&quot;
        src=&quot;/static/title-94b943af8e45cbe71e982fda3c15fdd8-222ea.jpg&quot;
        srcset=&quot;/static/title-94b943af8e45cbe71e982fda3c15fdd8-222ea.jpg 160w&quot;
        sizes=&quot;(max-width: 160px) 100vw, 160px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  &lt;/p&gt;
&lt;h1&gt;各章メモ&lt;/h1&gt;
&lt;h2&gt;1章  知能って何だろう&lt;/h2&gt;
&lt;p&gt;前半は「知能」を様々な角度から定義している「自分の内部と外部の境界にあるもので、内部を守るものである」
「体と環境も関係を取り持つもの」、「生き物に共通する性質である」、「宇宙の対義語」、「言葉を操り、記憶と推論の能力を有するもの (西洋の人工知能の大きな流れ)」
「環境に適応させながら体を目的に向かって運動させるもの (上記のの反対)」など。&lt;br&gt;
後半はゲームの知能の歴史について記述されている。
初期のゲームでは知能というよりギミックのレベルであり、2Dゲームから3Dゲームへの変化によりAIの方向性に違いが出てくる。
日本では「ゲームデザインの工夫によりAIの役割を絞り込み作りこむ」、海外では「環境を認識するようなAI作りをしていた」という違いもあるが、
それらのノウハウを業界全体で共有するという方向性が日本には欠けていた。他律型AIではスケールが大きくなると対応できなくなるので、
ウェイポイントデータなどの知識表現をキャラクターに与え、「知識x思考」で自律的に判断するAIを作成することが重要。&lt;/p&gt;
&lt;h2&gt;2章  知性を表現する手法 ~ ゲームAI 基礎概念&lt;/h2&gt;
&lt;p&gt;AIを表現する簡易的なモデルについて書かれている。
グラフィックスの進化に伴い現実感のない行動をするキャラクターに対して違和感を感じる「不気味の谷」を超えるために、
人間の当たり前をAIができるように作りこまなければならない。例では、NPCなどの「キャラクターAI」に加え、
キャラクターAIのサポートを行う「ナビゲーションAI」、ゲームの流れを作る「メタAI」の3つのAI連携、「メタ思考」・「メタ知識」の連携、ブラックボードアーキテクチャの応用等について。&lt;/p&gt;
&lt;h2&gt;3章  人工知能の根底にあるもの ~ AIの根本概念&lt;/h2&gt;
&lt;p&gt;「フレーム」を人間が定義することでAIは世界をとらえることができ、問題を解くことができるがフレームを伸縮させることはできない。
実際の世界は「無限の情報」、「連続的」、「状態が流動的に変化する」という特徴をもっており、全体の中化から最適解を選択するのではなく、想像する力がAIには必要である。&lt;/p&gt;
&lt;h2&gt;4章  キャラクターの意志はどう決められるか ~ 意思決定のアルゴリズム&lt;/h2&gt;
&lt;p&gt;ゲームでは人間がどのようなプロセスで意思決定をしているかということについて、ゲームでで使われる7つのモデルがまとめられている。
それぞれのモデルには得意・不得意な状況があり、「対局を判定」 &gt; 「具体的な行動を決定」をそれぞれ別のモデルで行うなど複数のモデルを組み合わせて解決する。
ここで紹介されているのはあくまでコンセプトであり、実際にはこれらを深く掘り下げていったアルゴリズムが使われている。&lt;/p&gt;
&lt;h2&gt;5章  ゲームAIは世界をどう認識するか ~ ゲームAI基礎概念(深部)&lt;/h2&gt;
&lt;p&gt;AIは物や出来事に対する「知識表現」を通して世界を認識することができる。
空間を理解する場合は、空間の特徴的な点を結ぶ「ウェイポイント・グラフ」、三角形ごとに地形の情報を持たせる「ナビゲーション・グラフ」を使ったりする。
AIどおしで情報をやりとする決まりを決めておく「メッセージング」、また、団体では直接情報をやりとりせずに「レイノルズの群れアルゴリズム」を用いて一定の距離内に存在するAIの情報をもとに行動を決定したりする。&lt;/p&gt;
&lt;h2&gt;6章  成長するAI ~ 学術・ゲームにおける共通概念&lt;/h2&gt;
&lt;p&gt;AIが学習する方法ついて書かれている。1AIの学習では、情報とその信頼度を使い情報を調整して保持する方法があり、
AIが織りなす社会的な側面ではそれぞれのAI関係をグラフにした「ソーシャル・ネットワーク・グラフ」を使って情報を伝達していく。
後半は、自らを現在の環境に最適な状態とする適応、行動とその結果から次の行動を調整する学習、
複数の学習したAIからより優位なAIどうしを交叉させて次の世代を生み出す進化を行うことでAIが成長していくことが説明されている。
ニューラルネットワークはゲームを作成する側が調整することが難しいため、実際のゲームでは余り採用されていないらしい。&lt;/p&gt;
&lt;h2&gt;7章  身体とAI ~ 身体感覚をつなぐインターフェース&lt;/h2&gt;
&lt;p&gt;キャラクターAIの知能は体抜きに作るのは不可能であり、知能には「自分の行動と世界の変化を同時に想像できる」こと、「ある程度、想像通りに身体を動かせる」ことが求められる。
自身の「内部状態」、環境の「外部状態」、物に対しての「アフォーダンス」をもとに行動を決定していく。さらに、環境側からキャラクターを制御するような、
環境とキャラクターが相互に情報をやりとりし機能を実現する「分散人工知能」で機能を実現していく。&lt;/p&gt;
&lt;h2&gt;8章  集団の知能を表現するテクニック ~ 群衆AIの技術&lt;/h2&gt;
&lt;p&gt;モブ(群衆)が自然に行動しているように見せる技術について書かれている。
街の群衆を表現する例を使って、プレイヤーの距離と密度、イベント発生点と距離による群衆の行動、LODとAIの詳細度などについて述べられている。
その他は、セルベース、階層型チームプランニング、合議制アルゴリズム、トークンを使ったターゲティング、プレイヤーレベルに合わせたスロットによる配置など。&lt;/p&gt;
&lt;h2&gt;9章  人間らしさの作り方 ~ ゲームを面白くするためのAI&lt;/h2&gt;
&lt;p&gt;NPC等の「キャラクターAI」、地形・レベルの自動生成技術「プロシージャル」、それらをいつ配置するかを判断する「メタAI」が組み合わせることで
質の高いゲームの自動生成がかのうとなるので、これからはこれらをブラッシュアップしていくことで全体な質を高められる。&lt;/p&gt;
&lt;h1&gt;感想&lt;/h1&gt;
&lt;p&gt;ゲーム開発者はゲームAIをどのように考えており、設計・実装しているのかが気になったのでこの本を読んだ。&lt;br&gt;
最近はニューラルネットワークなどの機械学習が話題となっており、その結果得られたものがAIであると錯覚してしまっていたが、
この本を読んで、人工知能を通して知能とはなんであるかということを探求することから始まり、改めてAIがどういうものであるか、どのように作られているかを認識できたことが大きい。&lt;br&gt;
「不気味の谷」についてはゲームをプレイしているときにもよく感じていたことで、いかに違和感をプレイヤーに感じさせないことがゲームAIでは重要だと思う。
それについて、近年のゲームで使われているAIコンセプト・モデル・テクニックだったりがたくさん学べてよかった。群衆のLODについてグラフィックだけでなくAIの行動にも適応されているテクニックが特に面白かった。&lt;/p&gt;
&lt;p&gt;別だけど、以下はゲームAIをどのように学習させているかや、ボットの置き換えだけでなくデバッグ用やプロシージャルなど様々な場所で使われているという話。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.ea.com/news/teaching-ai-agents-battlefield-1&quot;&gt;Teaching AI-agents to Play Battlefield 1&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[HTTP Varyヘッダについて]]></title><description><![CDATA[HTTP Varyヘッダとはクライアントとサーバ間(以下 オリジンサーバ)にCDN等のキャッシュサーバへキャッシュの扱い方を指定するためのフィールド。 背景と問題 同じURLへのアクセスでもリクエストに含まれるAccept-Language…]]></description><link>https://rtam.xyz/articles/2018/02/about-http-vary-field/</link><guid isPermaLink="false">https://rtam.xyz/articles/2018/02/about-http-vary-field/</guid><pubDate>Sat, 17 Feb 2018 20:43:14 GMT</pubDate><content:encoded>&lt;p&gt;HTTP Varyヘッダとはクライアントとサーバ間(以下 オリジンサーバ)にCDN等のキャッシュサーバへキャッシュの扱い方を指定するためのフィールド。&lt;/p&gt;
&lt;h1&gt;背景と問題&lt;/h1&gt;
&lt;p&gt;同じURLへのアクセスでもリクエストに含まれるAccept-Languageヘッダによって言語ごとに異なるレスポンスをサーバが返す場合、
キャッシュサーバが&lt;strong&gt;URLのみ&lt;/strong&gt;で  「キャッシュを利用するか」/「オリジンサーバへ問い合わせをするか」を判断してしまうと、
Accept-Languageヘッダで指定された言語にオリジンサーバが対応しているにもかかわらず、
キャッシュサーバが間違ったレスポンスを返してしまう可能性がある。これを解決するのが&lt;code&gt;Vary&lt;/code&gt;フィールド。&lt;/p&gt;
&lt;h1&gt;Varyフィールド&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;Vary&lt;/strong&gt;フィールドは&lt;a href=&quot;https://tools.ietf.org/html/rfc7231#section-7.1.4&quot;&gt;RFC7231&lt;/a&gt;で定義されている。
以下の図はVaryフィールドを使った異なる言語に対するレスポンスの振り分けの例。&lt;br&gt;
クライアントから3回リクエストが送信されていますが、Varyフィールドで言語ごとのレスポンスをキャッシュサーバへキャッシュしている。&lt;/p&gt;
&lt;p&gt;
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 138.93333333333334%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAACXBIWXMAAAsSAAALEgHS3X78AAAFsElEQVRIx51WfUxTVxR/fQVKKairOkVkgZnMMDHL4sxm9pFsWZhz0Uw3M2di9vHPNjPngouOmSVbRJNtKqMSqMpXvykWYXwoH0U7sAjYQrSlfX19r6+vfW0pWBGoxK/5dt6jZSgQk93k5Nx37nnnnvs759xzEQRG5HavgON2u2WR3+8zAHX7fD6T3+9vt1gsUpqm98K3xePxtIPMSlHUdqfTmQ3zbpBdgvUeoHLOBjJ5twaJD+UZNikQCNsDgeBDUH4UCoXu9Pf3r2QY5vj4+DhLkuTU5OQkC2vfut3u3HA4zMnugx4bCAQGZgyRtPowTikslF9j9IUMPtzT8HVvT3gJ7rasYlkWjU4xaR7KkeH1Yqst1mvpXV3dYqOxQwibrXA4HKtsNlu62WyWzhjEPcp3h1wV+SSt+io4qtuPkaczkP8x7HY7goRuaucs4B71Vut1udzcJysyXTl5utdSUmbHKoodeJXMyxiWczos60ZvTXQLjZ1a0TXrRaEbDyOXzQenDWCkAoUfEgivKon79vg03+MeRbuLrK4NjOjPRcbrDSNjdbWhm+dUPf1nJPN5x7JN87vNsvoFDvQSYjSdfLWl7VieUvPjjvKqAzsbmn/d3N5Z/KnNqcziHfE/cdq6+tM8b22vEDY0liQM4UUCitEkcjJvQPcWnCDoJKoIglYS4DE5MmbAhiPn//EG9PmczvjUX8LHDJaVlcW5AAjl5p/tyQev25Ce/rOiE0UHMg8V7Mna8fHb63btfn/Nptezl102tW65bGrmcW1tq0UWNFhaWorGPON39YX0uYArAdkw5MArCIpRM76QzgsYR/3D+n2cTvTeEx6CkTjnPYzjCUHaQtCqKorR9kCuDtxwVPxC0prXhiN17/iC+s0uUpXN6QEE04achFLg8ihRjFCh41PnBLqaMrSg4DA6MqaKeanVs2wHGxytgTw3s+FbdT/NDeZFJFZ69QtEmwUi+bmLVHwBwai3YeUawqtsBhi2T3tUm2C8VJ1o7lXwGw+5auKJrMoivOqNbq/6ZX9Iv7G9s2gliCWoULAsIVG4GuapQOjsDR+wrXG8hbOwn150e1UnMLL6JuVXY8HR2ghBa3ZzcrXuAA9y38Bxwd59W5Mqq48lsWw3+oBtEcwK5FyDl7r+TGxoKkzus5aJXB6FqLHlVGJGxnPJsLQEKB1opVicnLp+/TrOU2TnJ+8hv/9WurDByEQT7Hw1ZSzaLL5z/4L4UMGXYokkTRoztgYoA0XRpTk5OXzZZWZmzk6xeY5Mqf4A0Ic9PrUtOKIfJmntLh7025oZ3PLy8hCDwcB/S6VSJD09nZcXFxcL5XI5Py8pKYmnjeJ5uEk24ZTyFTqg23R9qHoFFwSRSJgGnKuCpSkpYtG2bR+I5suGppaz/HzqnhVBgqPaedPmxXVrObwkAoGAM5omkSRLNmzIXfTC2uUJqanJ0sVLJMtTJEhy4dGfF2t1cj54ao0sfn0pBeAd6qbU6OhtHdpyQYlyO88z4oFaHfM84ZSs+o3KciOPbf5++ePaMpksjoXgyJEjPF5XemX87hSjy4H70QZ1fA3IBilG+IJaR2CkNgK1/M10kTQ+rZYbYj1H8yZBq4s8fk0f9J/BG47yE1COH0IJ7mLC+s8hb3M5vVuT56fzE1riY2GHqKGFRwuFGHFGGKtl3UO2jaWDGkDCBLVs+GFucDpnkh2B1shz6F581KCbcRgKOIp1xe8wouqq3VXRAbeOBWp5Dycfm2xNMnWrRdbBRiH334WOg//tAL32yU0TY0FYFeNPHTOBJAiC5wMDA2nQsA3wCriKYVg/vAq6KisrVzidjny3GwdkHF0M479O++iPMMyVDQ+AHhzH/4aXRB84VDVjGV4B/NEGBwefgScHw70EQIGFH+6ClWdBdnxiYoJ7JdyLRqMsGNgHcv7lAM484jg4cYOz8S/oyoXy2PVRMwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;vary-flow-diagram&quot;
        title=&quot;&quot;
        src=&quot;/static/vary-flow-diagram-0cc8ac3ce135855d81980eb6fb4ef1cc-83a8b.png&quot;
        srcset=&quot;/static/vary-flow-diagram-0cc8ac3ce135855d81980eb6fb4ef1cc-8992e.png 163w,
/static/vary-flow-diagram-0cc8ac3ce135855d81980eb6fb4ef1cc-ae0a7.png 325w,
/static/vary-flow-diagram-0cc8ac3ce135855d81980eb6fb4ef1cc-83a8b.png 650w,
/static/vary-flow-diagram-0cc8ac3ce135855d81980eb6fb4ef1cc-ea5b0.png 750w&quot;
        sizes=&quot;(max-width: 650px) 100vw, 650px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&gt; 1回目のリクエスト&lt;br&gt;
キャッシュサーバにキャッシュがない状態ですのでキャッシュサーバからオリジンサーバへ問い合わせが発生する。その際、オリジンサーバは&lt;code&gt;Vary: Accept-Language&lt;/code&gt;をレスポンスに付加することで、キャッシュサーバはURLだけでなく、URL + &lt;code&gt;Accept-Language: ja&lt;/code&gt;をキーとしてレスポンスをキャッシュする。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-none&quot;&gt;&lt;code&gt;Content-Language: ja
Vary: Accept-Language&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&gt; 2回目のリクエスト&lt;br&gt;
キャッシュサーバに&lt;code&gt;Accept-Language: ja&lt;/code&gt;のリクエストが来ましたが、すでにキャッシュに登録されているためキャッシュのレスポンスをクライアントへ返する。&lt;strong&gt;オリジンサーバへのリクエストは発生しません&lt;/strong&gt;。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&gt; 3回目のリクエスト
&lt;code&gt;Accept-Language: en&lt;/code&gt;のリクエストが来ましたが、キャッシュサーバにはenのキャッシュはないので、オリジンサーバへ問い合わせ、帰ってきたレスポンスをenでキャッシュして、クライアントへ返する。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;まとめ&lt;/h1&gt;
&lt;p&gt; 言語によるレスポンス振り分けにおけるキャッシュサーバのキャッシュ制御についての例を確認しました。Varyフィールドは&lt;code&gt;Accept-Language&lt;/code&gt;だけでなく、他のフィールド指定や複数のフィールドをカンマで区切って指定することもできる。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-none&quot;&gt;&lt;code&gt;Vary: Accept-Encoding, Accept-Language&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt; なお、Varyヘッダではオリジンサーバの対応する形式などをキャッシュサーバへ伝えることができないので、それをできるようにする仕様HTTP Variantsというものも提案されている。  &lt;/p&gt;
&lt;h1&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://asnokaze.hatenablog.com/entry/2017/10/01/015550&quot;&gt;キャッシュサーバの効率を改善するHTTP Variantsという提案仕様 - ASnoKaze blog&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[The pixel pipeline]]></title><description><![CDATA[ブラウザがHTMLをレンダリングする際に何を行っているか The pixel pipeline ブラウザがレンダリングをする際に行っていることは、大きく分けると次の5つになる:  JavaScript : DOM操作で画面の見た目を変更にかかわるスクリプトの処理。 Style…]]></description><link>https://rtam.xyz/articles/2017/06/browser-pixel-pipeline/</link><guid isPermaLink="false">https://rtam.xyz/articles/2017/06/browser-pixel-pipeline/</guid><pubDate>Sat, 17 Jun 2017 18:23:51 GMT</pubDate><content:encoded>&lt;p&gt;ブラウザがHTMLをレンダリングする際に何を行っているか&lt;/p&gt;
&lt;h2&gt;The pixel pipeline&lt;/h2&gt;
&lt;hr&gt;
&lt;p&gt;ブラウザがレンダリングをする際に行っていることは、大きく分けると次の5つになる: &lt;/p&gt;
&lt;p&gt;
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 14.102564102564102%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAAzklEQVQI12NgYGBQB2JlIFZBopGxEhCbAbEelK2CA4PkjBjebRe58Gm38JHHqyT3NQRMPNQeM/9Ya+TsY7V+Uw8B8d6W8NnHO+LmHmzzW3Q0tTh2h/ca8cOxawyPBqxQOOa1VGJ/yCq1g1FrdI9FrtE5HrBY+SDD/2t6///fVPt/b7nb746Q5f8Xlmz/Pzdvy//O0MX/O0IX/ZuTu/n/oort/6dGb/6f3O/1PfSQ1P+Sox7/4/dp//fdKPE7Zb/R/9LjHv9Lz7j9T9pt9BQA/Upf4NlWTtUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;pixel-pipeline&quot;
        title=&quot;&quot;
        src=&quot;/static/pixel-pipeline-4052bd423d508eb6aaebaff495fd0351-83a8b.png&quot;
        srcset=&quot;/static/pixel-pipeline-4052bd423d508eb6aaebaff495fd0351-8992e.png 163w,
/static/pixel-pipeline-4052bd423d508eb6aaebaff495fd0351-ae0a7.png 325w,
/static/pixel-pipeline-4052bd423d508eb6aaebaff495fd0351-83a8b.png 650w,
/static/pixel-pipeline-4052bd423d508eb6aaebaff495fd0351-4d47c.png 858w&quot;
        sizes=&quot;(max-width: 650px) 100vw, 650px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;JavaScript&lt;/strong&gt;: DOM操作で画面の見た目を変更にかかわるスクリプトの処理。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Style&lt;/strong&gt;: 要素に対してどのCSSルールが適用されているかを計算するプロセス。
&lt;code&gt;.class1&lt;/code&gt;や&lt;code&gt;.class2&lt;/code&gt;のように複数CSSセレクタが該当するものは、CSS適用の優先度から最終的にあてはまるルールを決定する。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Layout&lt;/strong&gt;: 位置, 幅, 高さなど、要素がスクリーンのどのスペースを占めるかを決定するプロセス。Firefoxでは&lt;code&gt;reflow&lt;/code&gt;と呼ばれる。
&lt;code&gt;width&lt;/code&gt;, &lt;code&gt;height&lt;/code&gt;, &lt;code&gt;left&lt;/code&gt;, &lt;code&gt;top&lt;/code&gt; を変更するとLayout処理が発生する。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Paint&lt;/strong&gt;: 描画処理呼び出しリストの作成と要素ピクセルに色で埋める処理(ラスタライズ)を行う。
テキスト、色、画像、ボーダー、影を描画する処理を含む。
&lt;code&gt;color&lt;/code&gt;, &lt;code&gt;background-color&lt;/code&gt;や&lt;code&gt;border-radius&lt;/code&gt;, &lt;code&gt;border&lt;/code&gt;, &lt;code&gt;box-shadow&lt;/code&gt;などを変更するとPaintの処理が発生する。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Composite&lt;/strong&gt;: ブラウザは複数のレイヤ(*1)と呼ばれる単位で描画されている。ページ全体にレイヤが正しい順序で描画を行うプロセス。
&lt;code&gt;transform&lt;/code&gt;, &lt;code&gt;opacity&lt;/code&gt;の変更はこのプロセスのみを発生させる。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;再描画の際に実行されるプロセスが少ないほど高速となるので、アニメーションやスクロールなどの高負荷処理の部分では
&lt;strong&gt;Composite&lt;/strong&gt;のみを発生させるようチューニングするのが望ましい。&lt;/p&gt;
&lt;h2&gt;Side Navigationでパフォーマンス比較&lt;/h2&gt;
&lt;hr&gt;
&lt;p&gt;Side Navigationをアニメーションで表示させてパフォーマンスの違いを確認する&lt;/p&gt;
&lt;p&gt;使用するHTML&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-html&quot;&gt;&lt;code&gt;  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;side-menu&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;side-menu&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;header&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;button&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;menu-button&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;open&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;button&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;1. leftプロパティでアニメーション&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-css&quot;&gt;&lt;code&gt;&lt;span class=&quot;token selector&quot;&gt;.side-menu&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;left&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; -102%&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;transition&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; left 150ms linear&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token selector&quot;&gt;.side-menu--open&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;left&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; -70%&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;transition&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; left 150ms linear&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;2. transformプロパティでアニメーション&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;will-change&lt;/code&gt;プロパティでレイヤーを生成している。(非対応ブラウザには&lt;code&gt;transform: translateZ(0);&lt;/code&gt;)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-css&quot;&gt;&lt;code&gt;&lt;span class=&quot;token selector&quot;&gt;.side-menu&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;transform&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;translateX&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;-102%&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;transition&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; transform 300ms linear&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;will-change&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; transform&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token selector&quot;&gt;.side-menu--open&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;transform&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;translateX&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;-30%&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;transition&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; transform 300ms linear&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2&gt;比較結果&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;leftプロパティでアニメーション&lt;br&gt;
&lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 74px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 137.83783783783784%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAcABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAEEBf/EABcBAQEBAQAAAAAAAAAAAAAAAAECAAP/2gAMAwEAAhADEAAAAe3cjBB02yxjMov/xAAcEAACAQUBAAAAAAAAAAAAAAABAiEAAxAREjH/2gAIAQEAAQUCEL1FyWLtXZoneCN1cg4f3//EABYRAQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPwFMj//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABsQAAEEAwAAAAAAAAAAAAAAAAEAAhAhIDGR/9oACAEBAAY/AgJpq0eTeP8A/8QAHRABAAICAgMAAAAAAAAAAAAAAQARITFBgRBhcf/aAAgBAQABPyFm4Q4lMqfk2DEAoj1CvJMYi7rkqF0ZmkoMPrwrM+s//9oADAMBAAIAAwAAABA37TL/xAAYEQADAQEAAAAAAAAAAAAAAAAAATEQIf/aAAgBAwEBPxDqZGQf/8QAFxEBAAMAAAAAAAAAAAAAAAAAAQAQEf/aAAgBAgEBPxAFNjf/xAAcEAEAAwEAAwEAAAAAAAAAAAABABExIUFxsdH/2gAIAQEAAT8QUXBGEUmRwWzHIQ48SGwjHPyNrbdL8lsCaHwQGy56lcQl+GpSh5+mW0F5BF3Emu0n/9k=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;non-optimized&quot;
        title=&quot;&quot;
        src=&quot;/static/non-optimized-1bc5cfa7f05a8ebce021394083b0344c-3caab.jpg&quot;
        srcset=&quot;/static/non-optimized-1bc5cfa7f05a8ebce021394083b0344c-3caab.jpg 74w&quot;
        sizes=&quot;(max-width: 74px) 100vw, 74px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
    &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;transformプロパティでアニメーション&lt;br&gt;
&lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 91px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 110.98901098901099%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAWABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAEDBAX/xAAWAQEBAQAAAAAAAAAAAAAAAAACAwD/2gAMAwEAAhADEAAAAe3NDagG+oKGYG//xAAaEAACAwEBAAAAAAAAAAAAAAAAAQIREwMS/9oACAEBAAEFArLOquWbPDqSaeqNUdJXL//EABcRAAMBAAAAAAAAAAAAAAAAAAACMRD/2gAIAQMBAT8BFmLD/8QAFREBAQAAAAAAAAAAAAAAAAAAESD/2gAIAQIBAT8BI//EABkQAAIDAQAAAAAAAAAAAAAAAAAyECAxof/aAAgBAQAGPwIyGG5X/8QAHBAAAwACAwEAAAAAAAAAAAAAAAERIUExUWHB/9oACAEBAAE/IVOIWH3swUvyNewKCb10eDPBibJPg//aAAwDAQACAAMAAAAQoNAA/8QAGBEAAgMAAAAAAAAAAAAAAAAAADEBEBH/2gAIAQMBAT8QyRNIP//EABgRAAMBAQAAAAAAAAAAAAAAAAABMRBh/9oACAECAQE/EF0O46f/xAAcEAEBAAIDAQEAAAAAAAAAAAABEQAhMUFxUWH/2gAIAQEAAT8QgKIAXLWB/LgFpxq37ihDLudcUI9eI3hIK10zt4/M0pz+YEAIN5//2Q==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;optimized&quot;
        title=&quot;&quot;
        src=&quot;/static/optimized-f94261efed0410d574b6d99a0091ea61-8a231.jpg&quot;
        srcset=&quot;/static/optimized-f94261efed0410d574b6d99a0091ea61-8a231.jpg 91w&quot;
        sizes=&quot;(max-width: 91px) 100vw, 91px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  &lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;大幅な差は確認できなかったが、transformプロパティでのアニメーションのほうがFPSが安定していることがわかった。
今回は調査しなかったが&lt;code&gt;will-change&lt;/code&gt;プロパティはGPUメモリにレイヤを格納し続けるのでスマートフォンなどでは電池消費が大きくなるそうで、
アニメーション直前に&lt;code&gt;will-change&lt;/code&gt;をオンにするのが良い方法らしい。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;*1 レイヤー&lt;/strong&gt;: GPUで処理される領域。GPUへテクスチャとしてアップロードされる。1つのレイヤが大きい場合はより小さいタイルという単位でアップロードされる。&lt;/p&gt;
&lt;h1&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://developers.google.com/web/fundamentals/performance/rendering/&quot;&gt;Rendering Performance&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://medium.com/outsystems-experts/how-to-achieve-60-fps-animations-with-css3-db7b98610108&quot;&gt;Smooth as Butter: Achieving 60 FPS Animations with CSS3&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://csstriggers.com/&quot;&gt;CSS Triggers&lt;/a&gt; どのCSSルールがどのプロセスを発生させるか&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.slideshare.net/yoshikawa_t/chrome-developer-tools-17787728&quot;&gt;Chrome Developer Toolsを使いこなそう！&lt;/a&gt; &lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://qiita.com/cy-mitsuki/items/51a0a4c17b89154a7af2&quot;&gt;DevToolsのTimelineパネルを見ながら、レンダリングの仕組みを理解する&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.html5rocks.com/ja/tutorials/speed/layers/&quot;&gt;Accelerated Rendering in Chrome&lt;/a&gt; Chromeのレイヤー概念とGPUについて&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[SQLでのRandom Selection]]></title><description><![CDATA[MySQLでランダムなデータを取得する場合によく利用されるのがorder by rand()だが、これはインデックスが適用されないので、代替え方法をいくつか調査したまとめ ランダムにソートする方法 MySQLでランダムにデータを選択する方法を調べてみると、よくあるのが order…]]></description><link>https://rtam.xyz/articles/2017/06/sql-randam-selection/</link><guid isPermaLink="false">https://rtam.xyz/articles/2017/06/sql-randam-selection/</guid><pubDate>Fri, 09 Jun 2017 00:34:24 GMT</pubDate><content:encoded>&lt;p&gt;MySQLでランダムなデータを取得する場合によく利用されるのがorder by rand()だが、これはインデックスが適用されないので、代替え方法をいくつか調査したまとめ&lt;/p&gt;
&lt;h2&gt;ランダムにソートする方法&lt;/h2&gt;
&lt;p&gt;MySQLでランダムにデータを選択する方法を調べてみると、よくあるのが&lt;code&gt;order by rand()&lt;/code&gt;で
ランダムにソートして、上から欲しい件数だけ取得する方法が見つかる。SQLは以下のようなもの。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-sql&quot;&gt;&lt;code&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; customer &lt;span class=&quot;token keyword&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;by&lt;/span&gt; rand&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;limit&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;この場合、全レコードソートを行われるが&lt;strong&gt;インデックスが使われず、テーブルスキャンでのソート&lt;/strong&gt;となる。&lt;br&gt;
&lt;code&gt;explain&lt;/code&gt;の結果もtypeが&lt;code&gt;All&lt;/code&gt;, extraが&lt;code&gt;using filesort&lt;/code&gt;かつ&lt;code&gt;using temporary&lt;/code&gt;となっていて、
SQLとしてはかなり非効率なものであることがわかる。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-sql&quot;&gt;&lt;code&gt;&lt;span class=&quot;token keyword&quot;&gt;desc&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; customer &lt;span class=&quot;token keyword&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;by&lt;/span&gt; rand&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;limit&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;\G
&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;row&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
           id: &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  select_type: &lt;span class=&quot;token keyword&quot;&gt;SIMPLE&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;table&lt;/span&gt;: customer
         &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt;: &lt;span class=&quot;token keyword&quot;&gt;ALL&lt;/span&gt;
possible_keys: &lt;span class=&quot;token boolean&quot;&gt;NULL&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;key&lt;/span&gt;: &lt;span class=&quot;token boolean&quot;&gt;NULL&lt;/span&gt;
      key_len: &lt;span class=&quot;token boolean&quot;&gt;NULL&lt;/span&gt;
          ref: &lt;span class=&quot;token boolean&quot;&gt;NULL&lt;/span&gt;
         &lt;span class=&quot;token keyword&quot;&gt;rows&lt;/span&gt;: &lt;span class=&quot;token number&quot;&gt;646&lt;/span&gt;
        Extra: &lt;span class=&quot;token keyword&quot;&gt;Using&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;temporary&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;Using&lt;/span&gt; filesort
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;解決法1: 最小値と最大値のランダムなキーを選択する&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-sql&quot;&gt;&lt;code&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;
  customer &lt;span class=&quot;token number&quot;&gt;c&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;inner&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;join&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;-- [IDの最大値 * (0.0-1.0)のランダム値] の切り上げ&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; ceil&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rand&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;customer_id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; customer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; rand_id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; rnd
&lt;span class=&quot;token keyword&quot;&gt;on&lt;/span&gt; 
  &lt;span class=&quot;token number&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;customer_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; rnd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;rand_id
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;複数行の中秋する場合はユーザ定義変数を利用する&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-sql&quot;&gt;&lt;code&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; 
    t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; 
    ceil&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      rand&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; 
          &lt;span class=&quot;token function&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;customer_id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;
          customer
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; random_num&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token variable&quot;&gt;@num&lt;/span&gt;:&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;@num&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;@num&lt;/span&gt;:&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; customer
  &lt;span class=&quot;token keyword&quot;&gt;limit&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
customer &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; t
&lt;span class=&quot;token keyword&quot;&gt;where&lt;/span&gt;
    &lt;span class=&quot;token number&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;random_num &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;customer_id&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h4&gt;デメリット&lt;/h4&gt;
&lt;p&gt; IDに欠番がある場合は使用できない&lt;/p&gt;
&lt;h3&gt;解決策2: 最小値と最大値のランダムなキーを選択する(欠番がある場合は欠番後の最初のキーを選択)&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-sql&quot;&gt;&lt;code&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;
  customer &lt;span class=&quot;token number&quot;&gt;c&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;inner&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;join&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;-- [IDの最大値 * (0.0-1.0)のランダム値] の切り上げ&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; ceil&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rand&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;customer_id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; customer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; rand_id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; rnd
&lt;span class=&quot;token keyword&quot;&gt;on&lt;/span&gt; 
  &lt;span class=&quot;token comment&quot;&gt;-- ランダムな位置に最も近いIDを選択&lt;/span&gt;
  &lt;span class=&quot;token number&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;customer_id &lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt; rnd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;rand_id
&lt;span class=&quot;token keyword&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;by&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;customer_id
&lt;span class=&quot;token keyword&quot;&gt;limit&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h4&gt;メリット&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;IDに欠番がある場合でも使用可能&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;デメリット&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;複数選択する場合はランダムな位置から連番のものが選択される&lt;/li&gt;
&lt;li&gt;欠番の次のIDがが選択される確率が高い&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;解決策3: オフセットを用いてランダムに選択&lt;/h3&gt;
&lt;p&gt;SQLのみでなくアプリケーションも使用して、ランダムに行数を選択するSQLとその行数目を&lt;code&gt;offset&lt;/code&gt;で選択する。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-sql&quot;&gt;&lt;code&gt;&lt;span class=&quot;token comment&quot;&gt;-- ランダムに行数を選択するSQL&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; floor&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rand&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; customer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; id_offset&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- &lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; customer &lt;span class=&quot;token keyword&quot;&gt;limit&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;offset&lt;/span&gt; :&lt;span class=&quot;token keyword&quot;&gt;offset&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h4&gt;メリット&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;IDが数値でなくても使用できる&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;デメリット&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;2回SQLを発行する必要がある&lt;/li&gt;
&lt;li&gt;offsetが大きいと&lt;strong&gt;先頭からOFFSETまでの検索も行う&lt;/strong&gt;ので遅くなる&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;使用するテーブルについて&lt;/h2&gt;
&lt;p&gt;この記事で使用するテーブル一覧&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-sql&quot;&gt;&lt;code&gt;&lt;span class=&quot;token keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;`&lt;/span&gt;customer&lt;span class=&quot;token punctuation&quot;&gt;`&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;`&lt;/span&gt;customer_id&lt;span class=&quot;token punctuation&quot;&gt;`&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;smallint&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; unsigned &lt;span class=&quot;token keyword&quot;&gt;AUTO_INCREMENT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;KEY&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;`&lt;/span&gt;customer_id&lt;span class=&quot;token punctuation&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2&gt;まとめ&lt;/h2&gt;
&lt;p&gt;今のところ、それぞれを使う場面は以下のようになる。&lt;/p&gt;
&lt;p&gt;IDが数値 &amp;#x26; 連番 =&gt; 解決策1&lt;br&gt;
IDが数値 &amp;#x26; 連番でない =&gt; 解決策2&lt;br&gt;
IDが数値でない =&gt; 解決策3  &lt;/p&gt;
&lt;p&gt;他にもワークテーブルを使用した方法もあるようなので、要調査。&lt;/p&gt;
&lt;h2&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://www.r-5.org/files/books/computers/languages/sql/style/Bill_Karwin-SQL_Antipatterns-EN.pdf&quot;&gt;SQL Antipattern&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.mysqltutorial.org/select-random-records-database-table.aspx&quot;&gt;MySQL Select Random Records | MySQL Tutorial&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://jan.kneschke.de/projects/mysql/order-by-rand/&quot;&gt;ORDER BY RAND() &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://deaimobi.com/mbnk-307/&quot;&gt;MySQLのlimitで大量データのパフォーマンスが遅い重い！&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[node_modules/.binのcmdファイルについて]]></title><description><![CDATA[npmでインストールしたコマンドが"node_modules/.bin"ディレクトリにcmdファイルで生成される。そのcmdファイルのソースを読んで理解する。 cmdファイルのソースコード(eslintの場合) 今回はeslintのcmd…]]></description><link>https://rtam.xyz/articles/2017/05/read-node_modules-bin/</link><guid isPermaLink="false">https://rtam.xyz/articles/2017/05/read-node_modules-bin/</guid><pubDate>Sat, 13 May 2017 22:00:00 GMT</pubDate><content:encoded>&lt;p&gt;npmでインストールしたコマンドが&quot;node_modules/.bin&quot;ディレクトリにcmdファイルで生成される。そのcmdファイルのソースを読んで理解する。&lt;/p&gt;
&lt;h2&gt;cmdファイルのソースコード(eslintの場合)&lt;/h2&gt;
&lt;p&gt;今回はeslintのcmdファイルを読むが、他のコマンドも同様の形式なので１つ理解すれば問題ない。
以下がソースコードになる。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-cmd&quot;&gt;&lt;code&gt;@IF EXIST &quot;%~dp0\node.exe&quot; (                           // (1)
  &quot;%~dp0\node.exe&quot;  &quot;%~dp0\..\eslint\bin\eslint.js&quot; %* // (2)
) ELSE (
  @SETLOCAL                                            // (3)
  @SET PATHEXT=%PATHEXT:;.JS;=;%                       // (4)
  node  &quot;%~dp0\..\eslint\bin\eslint.js&quot; %*
)&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h4&gt;TL;DR&lt;/h4&gt;
&lt;p&gt;cmdファイル全体では,
(1) cmdファイルのディレクトリに&lt;code&gt;node.exe&lt;/code&gt;が存在するか
=&gt; する： node.exeでeslint実行
=&gt; しない: js拡張子もの含めたパスでnodeコマンドにより、eslint実行&lt;/p&gt;
&lt;h4&gt;(1)の部分&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;%~dp0&lt;/code&gt;はcmdファイル内で使用できる変数で、「実行されているファイルディレクトリのパス」を表す&lt;/p&gt;
&lt;h4&gt;(2)の部分&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;%*&lt;/code&gt;はコマンドに続く任意数の引数を表す。
つまり、(2)はnodejsでeslint.jsを実行しており、cmdファイルの引数を全て渡している。&lt;/p&gt;
&lt;h4&gt;(3)の部分&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;Starts localization of environment variables in a batch file. Localization continues until a matching endlocal command is encountered or the end of the batch file is reached.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;@SETLOCAL&lt;/code&gt;はcmdファイル内でのみ有効な環境変数を定義できるようになる宣言になる。
&lt;code&gt;@ENDLOCAL&lt;/code&gt;が呼ばれるまでの間の&lt;code&gt;@SET&lt;/code&gt;で設定された設定はcmdファイル内のみ有効になる。&lt;/p&gt;
&lt;h4&gt;(4)の部分&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;PathExt environment variable returns a list of the file extensions that the operating system considers to be executable. When executing a command line that does not contain an extension, the command interpreter (cmd.exe) uses the value of this environment variable to determine which extensions to look for and in what order.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;環境変数&lt;code&gt;PATHEXT&lt;/code&gt;はWindowsが実行可能と判断するファイル拡張子リストである。
(4)ではPATHEXTに拡張子がJSのファイルを追加している。&lt;/p&gt;
&lt;h1&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://pentan.info/server/windows/cmd/dp0.html&quot;&gt;%~dp0 とは&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://superuser.com/questions/149951/does-in-batch-file-mean-all-command-line-arguments&quot;&gt;does %* in batch file mean all command line arguments?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://technet.microsoft.com/en-us/library/bb491001.aspx&quot;&gt;Setlocal&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://environmentvariables.org/PathExt&quot;&gt;PathExt&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Gatsby+GitHub Pages+Cloudflareで静的Webサイト構築]]></title><description><![CDATA[Gatsbyを使って静的WebサイトをMarkdownで作成し、CircleCI経由でGitHub Pagesにデプロイ。GitHub Pagesはカスタムドメインを設定し、Cloudflare経由でSSLアクセスを可能にする。 手順 Gatsby…]]></description><link>https://rtam.xyz/articles/2017/05/making-blog-site/</link><guid isPermaLink="false">https://rtam.xyz/articles/2017/05/making-blog-site/</guid><pubDate>Thu, 04 May 2017 13:12:00 GMT</pubDate><content:encoded>&lt;p&gt;Gatsbyを使って静的WebサイトをMarkdownで作成し、CircleCI経由でGitHub Pagesにデプロイ。GitHub Pagesはカスタムドメインを設定し、Cloudflare経由でSSLアクセスを可能にする。&lt;/p&gt;
&lt;h1&gt;手順&lt;/h1&gt;
&lt;h2&gt;Gatsbyの導入&lt;/h2&gt;
&lt;h3&gt;インストール&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code&gt;&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; -g gatsby
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;config.toml設定&lt;/h3&gt;
&lt;p&gt;config.tomlはgatsbyの設定ファイル&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-yml&quot;&gt;&lt;code&gt;blogTitle = &quot;技術忘備録&quot;
authorName = &quot;r-tamura&quot;
authorDetail = &quot;Web関連多めのソフトウェアエンジニアです。&quot;
linkPrefix = &quot;&quot;
googleAnalyticsId = &quot;&quot;
syntaxTheme = &quot;ocean&quot;
twitterId = &quot;r_tamura30&quot;
facebookId = &quot;&quot;
githubId = &quot;r-tamura&quot;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2&gt;カスタムドメインの取得&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;http://www.onamae.com/&quot;&gt;お名前.com&lt;/a&gt;にて取得&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ドメイン名: &lt;code&gt;rtam.xyz&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;WHOIS情報: お名前.comに委譲&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;CircleCI経由でのデプロイ&lt;/h2&gt;
&lt;p&gt;CircleCIの設定ファイル&lt;code&gt;circle.yml&lt;/code&gt;にデプロイ用設定を入力&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-yml circle.yml&quot;&gt;&lt;code&gt;machine:
  node:
    version: 7.9.0
dependencies:
  override:
    - yarn install
test:
  override:
    - echo &quot;skip test...&quot;
deployment:
  production:
    branch: source # sourceブランチでビルドされた場合のみdeployを行う
    commands:
      - git config --global user.name &quot;CircleCI&quot;
      - git config --global user.email &quot;rtamura30@gmail.com&quot;
      - npm run clean
      - npm run build:prefix
      - npm run deploy
general:
  branches:
    ignore:
      - master # masterレポジトリpush時はcheckoutしない&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;デプロイ先のレポジトリへのDeploy keyがないので、作成してGitHub側に公開鍵, CircleCI側に秘密鍵を登録する&lt;/p&gt;
&lt;h3&gt;鍵の作成&lt;/h3&gt;
&lt;p&gt;rd&lt;em&gt;rsa, rd&lt;/em&gt;rsa.pubを生成する&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code&gt;// RSA / 2048bit / コメントなし / パスフレーズもなし
$ ssh-keygen -t rsa -b 2048 -C &lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;
Enter passphrase &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;empty &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; no passphrase&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;:
Enter same passphrase again:
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;秘密鍵をCircleへ登録&lt;/h3&gt;
&lt;p&gt;Circle CIダッシュボード &gt; PROJECTS &gt; [ブログプロジェクト] &gt; 右上の歯車マークの設定ボタン &gt; SSH Permissions &gt; Add SSH Key&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-none&quot;&gt;&lt;code&gt;Hostname: github.com
Private Key: id_rsaのテキスト&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;上記内容を入力して、Add SSH Keyを選択&lt;/p&gt;
&lt;h3&gt;公開鍵をGitHubへ登録&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;[デプロイ先プロジェクト]&lt;/strong&gt; &gt; Settings &gt; Deploy keys &gt; Add deploy key&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-none&quot;&gt;&lt;code&gt;Title: 任意
Key: id_rsa.pubのテキスト
Allow write access: チェックする&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;上記内容で設定し、Add keyを選択&lt;/p&gt;
&lt;h2&gt;Cloudflare設定&lt;/h2&gt;
&lt;h3&gt;Cloudflareアカウント登録&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cloudflare.com/&quot;&gt;Cloudflare&lt;/a&gt; &gt; Sign up &gt; アカウント情報入力 &gt; Create Account&lt;/p&gt;
&lt;h3&gt;DNS設定&lt;/h3&gt;
&lt;h4&gt;ドメイン名スキャン&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;rtam.xyz&lt;/code&gt;をテキストボックスに入力して[Scan DNS Records]でスキャンを開始する(1分弱かかる)&lt;/p&gt;
&lt;h4&gt;DNS設定&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;設定属性&lt;/th&gt;
&lt;th&gt;設定値&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Type&lt;/td&gt;
&lt;td&gt;A&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Name&lt;/td&gt;
&lt;td&gt;rtam.xyz&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Value&lt;/td&gt;
&lt;td&gt;192.30.252.153, 192.30.252.154&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TTL&lt;/td&gt;
&lt;td&gt;Automatic&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;Follow your DNS provider&apos;s instructions to create two A records that point your custom domain to the following IP addresses:&lt;/p&gt;
&lt;p&gt;192.30.252.153
192.30.252.154&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://help.github.com/articles/setting-up-an-apex-domain/#configuring-a-records-with-your-dns-provider&quot;&gt;Configuring A records with your DNS provider&lt;/a&gt;に記載されているIPを登録する&lt;/p&gt;
&lt;p&gt;上記設定後、Continueを選択&lt;/p&gt;
&lt;p&gt;※GitHubのレポジトリ設定画面で&lt;code&gt;Custom domain&lt;/code&gt;にカスタムドメインが設定されていることを確認する&lt;/p&gt;
&lt;p&gt;
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 15.983606557377051%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAADABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3qAH/8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABBQJ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFRABAQAAAAAAAAAAAAAAAAAAEEH/2gAIAQEAAT8hj//aAAwDAQACAAMAAAAQA8//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAXEAEAAwAAAAAAAAAAAAAAAAABABAh/9oACAEBAAE/ECAwa//Z&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;custom-domain&quot;
        title=&quot;&quot;
        src=&quot;/static/custom-domain-a1a20d1d50db4b9d27ae79dcf7a8b052-55338.jpg&quot;
        srcset=&quot;/static/custom-domain-a1a20d1d50db4b9d27ae79dcf7a8b052-a21e6.jpg 163w,
/static/custom-domain-a1a20d1d50db4b9d27ae79dcf7a8b052-4ac53.jpg 325w,
/static/custom-domain-a1a20d1d50db4b9d27ae79dcf7a8b052-55338.jpg 650w,
/static/custom-domain-a1a20d1d50db4b9d27ae79dcf7a8b052-e3f7a.jpg 732w&quot;
        sizes=&quot;(max-width: 650px) 100vw, 650px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  &lt;/p&gt;
&lt;h4&gt;Cloudflareプラン設定&lt;/h4&gt;
&lt;p&gt; 無料のFree Websiteを設定 &gt; Continueを選択&lt;/p&gt;
&lt;h4&gt;ネームサーバの確認&lt;/h4&gt;
&lt;p&gt;Cloudflareが用意するネームサーバが2つあることを確認し、メモする(次に、DNSレジストラ側でそのDNSサーバを設定するため) &gt; Continueを選択&lt;/p&gt;
&lt;h3&gt;ドメインレジストラのDNSサーバ設定をCloudflareのDNSに設定&lt;/h3&gt;
&lt;p&gt;お名前.comへアクセス &gt; ログイン &gt; 取得したドメインのネームサーバ &gt; 他のネームサーバを利用 &gt; Cloudflareで確認したネームサーバを登録&lt;/p&gt;
&lt;h3&gt;CloudflareでSSL設定&lt;/h3&gt;
&lt;h4&gt;SSL&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-none&quot;&gt;&lt;code&gt;SSL: Frexible&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;これによりClient &amp;#x3C;=&gt; Cloudflare 間はHTTPS, Cloudflare &amp;#x3C;=&gt; GitHub 間はHTTPとなる
GitHubにカスタムドメインの証明書を登録できないためa&lt;/p&gt;
&lt;h4&gt;HTTP Strict Transport Security (HSTS)&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;設定属性&lt;/th&gt;
&lt;th&gt;設定値&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Status&lt;/td&gt;
&lt;td&gt;On&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Max-Age&lt;/td&gt;
&lt;td&gt;6 months (recommended)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Include subdomains&lt;/td&gt;
&lt;td&gt;On&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Preload&lt;/td&gt;
&lt;td&gt;On&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;No-sniff&lt;/td&gt;
&lt;td&gt;On&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;Automatic HTTPS Rewrites&lt;/h4&gt;
&lt;p&gt;ONに設定する&lt;/p&gt;
&lt;h1&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://circleci.com/docs/1.0/adding-read-write-deployment-key/&quot;&gt;Adding read/write deployment key&lt;/a&gt; Deploy keyの登録方法&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.kaitoy.xyz/2016/07/01/https-support-by-cloudflare/&quot;&gt;CloudflareでブログをHTTPS化&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://qiita.com/superbrothers/items/95e5723e9bd320094537&quot;&gt;カスタムドメインの GitHub Pages で HTTPS を使う&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://help.github.com/articles/setting-up-an-apex-domain/#configuring-a-records-with-your-dns-provider&quot;&gt;Configuring A records with your DNS provider&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://help.github.com/articles/setting-up-a-custom-subdomain/&quot;&gt;Setting up a custom subdomain&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item></channel></rss>